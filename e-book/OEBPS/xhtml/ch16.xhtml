<?xml version="1.0" encoding="UTF-8"?>
<html xml:lang="en-us" lang="en-us" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:ns="http://www.w3.org/2001/10/synthesis">
<head>
<title>Automate the Boring Stuff with Python: Practical Programming for Total Beginners, 2nd Edition</title>
<link rel="stylesheet" type="text/css" href="../styles/9781593279936.css"/>
</head>
<body>
<h2 class="h2" id="ch16"><span epub:type="pagebreak" id="page_371"/><strong><span class="big">16</span><br/>WORKING WITH CSV FILES AND JSON DATA</strong></h2>
<div class="image1"><img src="../images/16fig00.jpg" alt="Image"/></div>
<p class="noindent">In <a href="ch15.xhtml#ch15">Chapter 15</a>, you learned how to extract text from PDF and Word documents. These files were in a binary format, which required special Python modules to access their data. CSV and JSON files, on the other hand, are just plaintext files. You can view them in a text editor, such as Mu. But Python also comes with the special <span class="literal">csv</span> and <span class="literal">json</span> modules, each providing functions to help you work with these file formats.</p>
<p class="indent">CSV stands for &#8220;comma-separated values,&#8221; and CSV files are simplified spreadsheets stored as plaintext files. Python&#8217;s <span class="literal">csv</span> module makes it easy to parse CSV files.</p>
<p class="indent">JSON (pronounced &#8220;JAY-sawn&#8221; or &#8220;Jason&#8221;&#8212;it doesn&#8217;t matter how because either way people will say you&#8217;re pronouncing it wrong) is a format that stores information as JavaScript source code in plaintext files. (JSON is short for JavaScript Object Notation.) You don&#8217;t need to know the JavaScript programming language to use JSON files, but the JSON format is useful to know because it&#8217;s used in many web applications.</p>
<h3 class="h3" id="ch16lev1sec1"><span epub:type="pagebreak" id="page_372"/><strong>The csv Module</strong></h3>
<p class="noindent">Each line in a CSV file represents a row in the spreadsheet, and commas separate the cells in the row. For example, the spreadsheet <em>example.xlsx</em> from <em><a href="https://nostarch.com/automatestuff2/">https://nostarch.com/automatestuff2/</a></em> would look like this in a CSV file:</p>
<p class="programs">4/5/2015 13:34,Apples,73<br/>
4/5/2015 3:41,Cherries,85<br/>
4/6/2015 12:46,Pears,14<br/>
4/8/2015 8:59,Oranges,52<br/>
4/10/2015 2:07,Apples,152<br/>
4/10/2015 18:10,Bananas,23<br/>
4/10/2015 2:40,Strawberries,98</p>
<p class="indent">I will use this file for this chapter&#8217;s interactive shell examples. You can download <em>example.csv</em> from <em><a href="https://nostarch.com/automatestuff2/">https://nostarch.com/automatestuff2/</a></em> or enter the text into a text editor and save it as <em>example.csv</em>.</p>
<p class="indent">CSV files are simple, lacking many of the features of an Excel spreadsheet. For example, CSV files:</p>
<ul>
<li class="noindent">Don&#8217;t have types for their values&#8212;everything is a string</li>
<li class="noindent">Don&#8217;t have settings for font size or color</li>
<li class="noindent">Don&#8217;t have multiple worksheets</li>
<li class="noindent">Can&#8217;t specify cell widths and heights</li>
<li class="noindent">Can&#8217;t have merged cells</li>
<li class="noindent">Can&#8217;t have images or charts embedded in them</li>
</ul>
<p class="indent">The advantage of CSV files is simplicity. CSV files are widely supported by many types of programs, can be viewed in text editors (including Mu), and are a straightforward way to represent spreadsheet data. The CSV format is exactly as advertised: it&#8217;s just a text file of comma-separated values.</p>
<p class="indent">Since CSV files are just text files, you might be tempted to read them in as a string and then process that string using the techniques you learned in <a href="ch09.xhtml#ch09">Chapter 9</a>. For example, since each cell in a CSV file is separated by a comma, maybe you could just call <span class="literal">split(',')</span> on each line of text to get the comma-separated values as a list of strings. But not every comma in a CSV file represents the boundary between two cells. CSV files also have their own set of escape characters to allow commas and other characters to be included <em>as part of the values</em>. The <span class="literal">split()</span> method doesn&#8217;t handle these escape characters. Because of these potential pitfalls, you should always use the <span class="literal">csv</span> module for reading and writing CSV files.</p>
<h4 class="h4" id="ch16lev2sec1"><span epub:type="pagebreak" id="page_373"/><strong><em>reader Objects</em></strong></h4>
<p class="noindent">To read data from a CSV file with the <span class="literal">csv</span> module, you need to create a <span class="literal">reader</span> object. A <span class="literal">reader</span> object lets you iterate over lines in the CSV file. Enter the following into the interactive shell, with <em>example.csv</em> in the current working directory:</p>
<p class="programs"><span class="ent">&#x278A;</span> &gt;&gt;&gt; <span class="codestrong1">import csv</span><br/>
<span class="ent">&#x278B;</span> &gt;&gt;&gt; <span class="codestrong1">exampleFile = open('example.csv')</span><br/>
<span class="ent">&#x278C;</span> &gt;&gt;&gt; <span class="codestrong1">exampleReader = csv.reader(exampleFile)</span><br/>
<span class="ent">&#x278D;</span> &gt;&gt;&gt; <span class="codestrong1">exampleData = list(exampleReader)</span><br/>
<span class="ent">&#x278E;</span> &gt;&gt;&gt; <span class="codestrong1">exampleData</span><br/>
&#160;&#160;&#160;[['4/5/2015 13:34', 'Apples', '73'], ['4/5/2015 3:41', 'Cherries', '85'],<br/>
&#160;&#160;&#160;['4/6/2015 12:46', 'Pears', '14'], ['4/8/2015 8:59', 'Oranges', '52'],<br/>
&#160;&#160;&#160;['4/10/2015 2:07', 'Apples', '152'], ['4/10/2015 18:10', 'Bananas', '23'],<br/>
&#160;&#160;&#160;['4/10/2015 2:40', 'Strawberries', '98']]</p>
<p class="indent">The <span class="literal">csv</span> module comes with Python, so we can import it <span class="ent">&#x278A;</span> without having to install it first.</p>
<p class="indent">To read a CSV file with the <span class="literal">csv</span> module, first open it using the <span class="literal">open()</span> function <span class="ent">&#x278B;</span>, just as you would any other text file. But instead of calling the <span class="literal">read()</span> or <span class="literal">readlines()</span> method on the <span class="literal">File</span> object that <span class="literal">open()</span> returns, pass it to the <span class="literal">csv.reader()</span> function <span class="ent">&#x278C;</span>. This will return a <span class="literal">reader</span> object for you to use. Note that you don&#8217;t pass a filename string directly to the <span class="literal">csv.reader()</span> function.</p>
<p class="indent">The most direct way to access the values in the <span class="literal">reader</span> object is to convert it to a plain Python list by passing it to <span class="literal">list()</span> <span class="ent">&#x278D;</span>. Using <span class="literal">list()</span> on this <span class="literal">reader</span> object returns a list of lists, which you can store in a variable like <span class="literal">exampleData</span>. Entering <span class="literal">exampleData</span> in the shell displays the list of lists <span class="ent">&#x278E;</span>.</p>
<p class="indent">Now that you have the CSV file as a list of lists, you can access the value at a particular row and column with the expression <span class="literal">exampleData[row][col]</span>, where <span class="literal">row</span> is the index of one of the lists in <span class="literal">exampleData</span>, and <span class="literal">col</span> is the index of the item you want from that list. Enter the following into the interactive shell:</p>
<p class="programs">&gt;&gt;&gt; <span class="codestrong1">exampleData[0][0]</span><br/>
'4/5/2015 13:34'<br/>
&gt;&gt;&gt; <span class="codestrong1">exampleData[0][1]</span><br/>
'Apples'<br/>
&gt;&gt;&gt; <span class="codestrong1">exampleData[0][2]</span><br/>
'73'<br/>
&gt;&gt;&gt; <span class="codestrong1">exampleData[1][1]</span><br/>
'Cherries'<br/>
&gt;&gt;&gt; <span class="codestrong1">exampleData[6][1]</span><br/>
'Strawberries'</p>
<p class="indent">As you can see from the output, <span class="literal">exampleData[0][0]</span> goes into the first list and gives us the first string, <span class="literal">exampleData[0][2]</span> goes into the first list and gives us the third string, and so on.</p>
<h4 class="h4" id="ch16lev2sec2"><span epub:type="pagebreak" id="page_374"/><strong><em>Reading Data from reader Objects in a for Loop</em></strong></h4>
<p class="noindent">For large CSV files, you&#8217;ll want to use the <span class="literal">reader</span> object in a <span class="literal">for</span> loop. This avoids loading the entire file into memory at once. For example, enter the following into the interactive shell:</p>
<p class="programs">&gt;&gt;&gt; <span class="codestrong1">import csv</span><br/>
&gt;&gt;&gt; <span class="codestrong1">exampleFile = open('example.csv')</span><br/>
&gt;&gt;&gt; <span class="codestrong1">exampleReader = csv.reader(exampleFile)</span><br/>
&gt;&gt;&gt; <span class="codestrong1">for row in exampleReader:</span><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="codestrong1">print('Row #' + str(exampleReader.line_num) + ' ' + str(row))</span><br/><br/>
Row #1 ['4/5/2015 13:34', 'Apples', '73']<br/>
Row #2 ['4/5/2015 3:41', 'Cherries', '85']<br/>
Row #3 ['4/6/2015 12:46', 'Pears', '14']<br/>
Row #4 ['4/8/2015 8:59', 'Oranges', '52']<br/>
Row #5 ['4/10/2015 2:07', 'Apples', '152']<br/>
Row #6 ['4/10/2015 18:10', 'Bananas', '23']<br/>
Row #7 ['4/10/2015 2:40', 'Strawberries', '98']</p>
<p class="indent">After you import the <span class="literal">csv</span> module and make a <span class="literal">reader</span> object from the CSV file, you can loop through the rows in the <span class="literal">reader</span> object. Each row is a list of values, with each value representing a cell.</p>
<p class="indent">The <span class="literal">print()</span> function call prints the number of the current row and the contents of the row. To get the row number, use the <span class="literal">reader</span> object&#8217;s <span class="literal">line_num</span> variable, which contains the number of the current line.</p>
<p class="indent">The <span class="literal">reader</span> object can be looped over only once. To reread the CSV file, you must call <span class="literal">csv.reader</span> to create a <span class="literal">reader</span> object.</p>
<h4 class="h4" id="ch16lev2sec3"><strong><em>writer Objects</em></strong></h4>
<p class="noindent">A <span class="literal">writer</span> object lets you write data to a CSV file. To create a <span class="literal">writer</span> object, you use the <span class="literal">csv.writer()</span> function. Enter the following into the interactive shell:</p>
<p class="programs">&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">import csv</span><br/>
<span class="ent">&#x278A;</span> &gt;&gt;&gt; <span class="codestrong1">outputFile = open('output.csv', 'w', newline='')</span><br/>
<span class="ent">&#x278B;</span> &gt;&gt;&gt; <span class="codestrong1">outputWriter = csv.writer(outputFile)</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">outputWriter.writerow(['spam', 'eggs', 'bacon', 'ham'])</span><br/>
&#160;&#160;&#160;21<br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">outputWriter.writerow(['Hello, world!', 'eggs', 'bacon', 'ham'])</span><br/>
&#160;&#160;&#160;32<br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">outputWriter.writerow([1, 2, 3.141592, 4])</span><br/>
&#160;&#160;&#160;16<br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">outputFile.close()</span></p>
<p class="indent">First, call <span class="literal">open()</span> and pass it <span class="literal">'w'</span> to open a file in write mode <span class="ent">&#x278A;</span>. This will create the object you can then pass to <span class="literal">csv.writer()</span> <span class="ent">&#x278B;</span> to create a <span class="literal">writer</span> object.</p>
<p class="indent">On Windows, you&#8217;ll also need to pass a blank string for the <span class="literal">open()</span> function&#8217;s <span class="literal">newline</span> keyword argument. For technical reasons beyond the scope of this book, if you forget to set the <span class="literal">newline</span> argument, the rows in <em>output.csv</em> will be double-spaced, as shown in <a href="ch16.xhtml#ch16fig01">Figure 16-1</a>.</p>
<div class="image"><span epub:type="pagebreak" id="page_375"/><a id="ch16fig01"/><img src="../images/16fig01.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 16-1: If you forget the <span class="literal">newline=''</span> keyword argument in <span class="literal">open()</span>, the CSV file will be double-spaced.</em></p>
<p class="indent">The <span class="literal">writerow()</span> method for <span class="literal">writer</span> objects takes a list argument. Each value in the list is placed in its own cell in the output CSV file. The return value of <span class="literal">writerow()</span> is the number of characters written to the file for that row (including newline characters).</p>
<p class="indent">This code produces an <em>output.csv</em> file that looks like this:</p>
<p class="programs">spam,eggs,bacon,ham<br/>
"Hello, world!",eggs,bacon,ham<br/>
1,2,3.141592,4</p>
<p class="indent">Notice how the <span class="literal">writer</span> object automatically escapes the comma in the value <span class="literal">'Hello, world!'</span> with double quotes in the CSV file. The <span class="literal">csv</span> module saves you from having to handle these special cases yourself.</p>
<h4 class="h4" id="ch16lev2sec4"><strong><em>The delimiter and lineterminator Keyword Arguments</em></strong></h4>
<p class="noindent">Say you want to separate cells with a tab character instead of a comma and you want the rows to be double-spaced. You could enter something like the following into the interactive shell:</p>
<p class="programs">&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">import csv</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">csvFile = open('example.tsv', 'w', newline='')</span><br/>
<span class="ent">&#x278A;</span> &gt;&gt;&gt; <span class="codestrong1">csvWriter = csv.writer(csvFile, delimiter='\t', lineterminator='\n\n')</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">csvWriter.writerow(['apples', 'oranges', 'grapes'])</span><br/>
&#160;&#160;&#160;24<br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">csvWriter.writerow(['eggs', 'bacon', 'ham'])</span><br/>
&#160;&#160;&#160;17<br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">csvWriter.writerow(['spam', 'spam', 'spam', 'spam', 'spam', 'spam'])</span><br/>
&#160;&#160;&#160;32<br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">csvFile.close()</span></p>
<p class="indent">This changes the delimiter and line terminator characters in your file. The <em>delimiter</em> is the character that appears between cells on a row. By default, the delimiter for a CSV file is a comma. The <em>line terminator</em> is the <span epub:type="pagebreak" id="page_376"/>character that comes at the end of a row. By default, the line terminator is a newline. You can change characters to different values by using the <span class="literal">delimiter</span> and <span class="literal">lineterminator</span> keyword arguments with <span class="literal">csv.writer()</span>.</p>
<p class="indent">Passing <span class="literal">delimiter='\t'</span> and <span class="literal">lineterminator='\n\n'</span> <span class="ent">&#x278A;</span> changes the character between cells to a tab and the character between rows to two newlines. We then call <span class="literal">writerow()</span> three times to give us three rows.</p>
<p class="indent">This produces a file named <em>example.tsv</em> with the following contents:</p>
<p class="programs">apples&#160;&#160;oranges grapes<br/><br/>
eggs&#160;&#160;&#160;&#160;bacon&#160;&#160;&#160;ham<br/><br/>
spam&#160;&#160;&#160;&#160;spam&#160;&#160;&#160;&#160;spam&#160;&#160;&#160;&#160;spam&#160;&#160;&#160;&#160;spam&#160;&#160;&#160;&#160;spam&#160;&#160;&#160;&#160;</p>
<p class="indent">Now that our cells are separated by tabs, we&#8217;re using the file extension <em>.tsv</em>, for tab-separated values.</p>
<h4 class="h4" id="ch16lev2sec5"><strong><em>DictReader and DictWriter CSV Objects</em></strong></h4>
<p class="noindent">For CSV files that contain header rows, it&#8217;s often more convenient to work with the <span class="literal">DictReader</span> and <span class="literal">DictWriter</span> objects, rather than the <span class="literal">reader</span> and <span class="literal">writer</span> objects.</p>
<p class="indent">The <span class="literal">reader</span> and <span class="literal">writer</span> objects read and write to CSV file rows by using lists. The <span class="literal">DictReader</span> and <span class="literal">DictWriter</span> CSV objects perform the same functions but use dictionaries instead, and they use the first row of the CSV file as the keys of these dictionaries.</p>
<p class="indent">Go to <em><a href="https://nostarch.com/automatestuff2/">https://nostarch.com/automatestuff2/</a></em> and download the <em>exampleWithHeader.csv</em> file. This file is the same as <em>example.csv</em> except it has Timestamp, Fruit, and Quantity as the column headers in the first row.</p>
<p class="indent">To read the file, enter the following into the interactive shell:</p>
<p class="programs">&gt;&gt;&gt; <span class="codestrong1">import csv</span><br/>
&gt;&gt;&gt; <span class="codestrong1">exampleFile = open('exampleWithHeader.csv')</span><br/>
&gt;&gt;&gt; <span class="codestrong1">exampleDictReader = csv.DictReader(exampleFile)</span><br/>
&gt;&gt;&gt; <span class="codestrong1">for row in exampleDictReader:</span><br/>
...&#160;&#160;&#160;&#160;&#160;<span class="codestrong1">print(row['Timestamp'], row['Fruit'], row['Quantity'])</span><br/>
...<br/>
4/5/2015 13:34 Apples 73<br/>
4/5/2015 3:41 Cherries 85<br/>
4/6/2015 12:46 Pears 14<br/>
4/8/2015 8:59 Oranges 52<br/>
4/10/2015 2:07 Apples 152<br/>
4/10/2015 18:10 Bananas 23<br/>
4/10/2015 2:40 Strawberries 98</p>
<p class="indent">Inside the loop, <span class="literal">DictReader</span> object sets <span class="literal">row</span> to a dictionary object with keys derived from the headers in the first row. (Well, technically, it sets <span class="literal">row</span> to an <span class="literal">OrderedDict</span> object, which you can use in the same way as a dictionary; the difference between them is beyond the scope of this book.) Using a <span class="literal">DictReader</span> object means you don&#8217;t need additional code to skip the first row&#8217;s header information, since the <span class="literal">DictReader</span> object does this for you.</p>
<p class="indent"><span epub:type="pagebreak" id="page_377"/>If you tried to use <span class="literal">DictReader</span> objects with <em>example.csv</em>, which doesn&#8217;t have column headers in the first row, the <span class="literal">DictReader</span> object would use <span class="literal">'4/5/2015 13:34'</span>, <span class="literal">'Apples'</span>, and <span class="literal">'73'</span> as the dictionary keys. To avoid this, you can supply the <span class="literal">DictReader()</span> function with a second argument containing made-up header names:</p>
<p class="programs">&gt;&gt;&gt; <span class="codestrong1">import csv</span><br/>
&gt;&gt;&gt; <span class="codestrong1">exampleFile = open('example.csv')</span><br/>
&gt;&gt;&gt; <span class="codestrong1">exampleDictReader = csv.DictReader(exampleFile, ['time', 'name',</span><br/>
<span class="codestrong1">'amount'])</span><br/>
&gt;&gt;&gt; <span class="codestrong1">for row in exampleDictReader:</span><br/>
...&#160;&#160;&#160;&#160;&#160;<span class="codestrong1">print(row['time'], row['name'], row['amount'])</span><br/>
...<br/>
4/5/2015 13:34 Apples 73<br/>
4/5/2015 3:41 Cherries 85<br/>
4/6/2015 12:46 Pears 14<br/>
4/8/2015 8:59 Oranges 52<br/>
4/10/2015 2:07 Apples 152<br/>
4/10/2015 18:10 Bananas 23<br/>
4/10/2015 2:40 Strawberries 98</p>
<p class="indent">Because <em>example.csv</em>&#8217;s first row doesn&#8217;t have any text for the heading of each column, we created our own: <span class="literal">'time'</span>, <span class="literal">'name'</span>, and <span class="literal">'amount'</span>.</p>
<p class="indent"><span class="literal">DictWriter</span> objects use dictionaries to create CSV files.</p>
<p class="programs">&gt;&gt;&gt; <span class="codestrong1">import csv</span><br/>
&gt;&gt;&gt; <span class="codestrong1">outputFile = open('output.csv', 'w', newline='')</span><br/>
&gt;&gt;&gt; <span class="codestrong1">outputDictWriter = csv.DictWriter(outputFile, ['Name', 'Pet', 'Phone'])</span><br/>
&gt;&gt;&gt; <span class="codestrong1">outputDictWriter.writeheader()</span><br/>
&gt;&gt;&gt; <span class="codestrong1">outputDictWriter.writerow({'Name': 'Alice', 'Pet': 'cat', 'Phone': '555-</span><br/>
<span class="codestrong1">1234'})</span><br/>
20<br/>
&gt;&gt;&gt; <span class="codestrong1">outputDictWriter.writerow({'Name': 'Bob', 'Phone': '555-9999'})</span><br/>
15<br/>
&gt;&gt;&gt; <span class="codestrong1">outputDictWriter.writerow({'Phone': '555-5555', 'Name': 'Carol', 'Pet':</span><br/>
<span class="codestrong1">'dog'})</span><br/>
20<br/>
&gt;&gt;&gt; <span class="codestrong1">outputFile.close()</span></p>
<p class="indent">If you want your file to contain a header row, write that row by calling <span class="literal">writeheader()</span>. Otherwise, skip calling <span class="literal">writeheader()</span> to omit a header row from the file. You then write each row of the CSV file with a <span class="literal">writerow()</span> method call, passing a dictionary that uses the headers as keys and contains the data to write to the file.</p>
<p class="indent">The <em>output.csv</em> file this code creates looks like this:</p>
<p class="programs">Name,Pet,Phone<br/>
Alice,cat,555-1234<br/>
Bob,,555-9999<br/>
Carol,dog,555-5555</p>
<p class="indent"><span epub:type="pagebreak" id="page_378"/>Notice that the order of the key-value pairs in the dictionaries you passed to <span class="literal">writerow()</span> doesn&#8217;t matter: they&#8217;re written in the order of the keys given to <span class="literal">DictWriter()</span>. For example, even though you passed the <span class="literal">Phone</span> key and value before the <span class="literal">Name</span> and <span class="literal">Pet</span> keys and values in the fourth row, the phone number still appeared last in the output.</p>
<p class="indent">Notice also that any missing keys, such as <span class="literal">'Pet'</span> in <span class="literal">{'Name': 'Bob', 'Phone': '555-9999'}</span>, will simply be empty in the CSV file.</p>
<h3 class="h3" id="ch16lev1sec2"><strong>Project: Removing the Header from CSV Files</strong></h3>
<p class="noindent">Say you have the boring job of removing the first line from several hundred CSV files. Maybe you&#8217;ll be feeding them into an automated process that requires just the data and not the headers at the top of the columns. You <em>could</em> open each file in Excel, delete the first row, and resave the file&#8212;but that would take hours. Let&#8217;s write a program to do it instead.</p>
<p class="indent">The program will need to open every file with the <em>.csv</em> extension in the current working directory, read in the contents of the CSV file, and rewrite the contents without the first row to a file of the same name. This will replace the old contents of the CSV file with the new, headless contents.</p>
<div class="note">
<p class="notet"><strong><span class="notes">WARNING</span></strong></p>
<p class="notep"><em>As always, whenever you write a program that modifies files, be sure to back up the files first, just in case your program does not work the way you expect it to. You don&#8217;t want to accidentally erase your original files.</em></p>
</div>
<p class="indent">At a high level, the program must do the following:</p>
<ol>
<li class="noindent">Find all the CSV files in the current working directory.</li>
<li class="noindent">Read in the full contents of each file.</li>
<li class="noindent">Write out the contents, skipping the first line, to a new CSV file.</li>
</ol>
<p class="indent">At the code level, this means the program will need to do the following:</p>
<ol>
<li class="noindent">Loop over a list of files from <span class="literal">os.listdir()</span>, skipping the non-CSV files.</li>
<li class="noindent">Create a CSV <span class="literal">reader</span> object and read in the contents of the file, using the <span class="literal">line_num</span> attribute to figure out which line to skip.</li>
<li class="noindent">Create a CSV <span class="literal">writer</span> object and write out the read-in data to the new file.</li>
</ol>
<p class="indent">For this project, open a new file editor window and save it as <em>removeCsvHeader.py</em>.</p>
<h4 class="h4" id="ch16lev2sec6"><strong><em>Step 1: Loop Through Each CSV File</em></strong></h4>
<p class="noindent">The first thing your program needs to do is loop over a list of all CSV filenames for the current working directory. Make your <em>removeCsvHeader.py</em> look like this:</p>
<p class="programs">#! python3<br/>
# removeCsvHeader.py - Removes the header from all CSV files in the current<br/><br/>
<span epub:type="pagebreak" id="page_379"/># working directory.<br/><br/>
import csv, os<br/><br/>
os.makedirs('headerRemoved', exist_ok=True)<br/><br/>
# Loop through every file in the current working directory.<br/>
for csvFilename in os.listdir('.'):<br/>
&#160;&#160;&#160;&#160;&#160;if not csvFilename.endswith('.csv'):<br/>
&#160;&#160;&#160;&#160;&#160;&#160;<span class="ent">&#x278A;</span> continue&#160;&#160;&#160;&#160;# skip non-csv files<br/><br/>
&#160;&#160;&#160;&#160;&#160;print('Removing header from ' + csvFilename + '...')<br/><br/>
&#160;&#160;&#160;&#160;&#160;# TODO: Read the CSV file in (skipping first row).<br/><br/>
&#160;&#160;&#160;&#160;&#160;# TODO: Write out the CSV file.</p>
<p class="indent">The <span class="literal">os.makedirs()</span> call will create a <span class="literal">headerRemoved</span> folder where all the headless CSV files will be written. A <span class="literal">for</span> loop on <span class="literal">os.listdir('.')</span> gets you partway there, but it will loop over <em>all</em> files in the working directory, so you&#8217;ll need to add some code at the start of the loop that skips filenames that don&#8217;t end with <span class="literal">.csv</span>. The <span class="literal">continue</span> statement <span class="ent">&#x278A;</span> makes the <span class="literal">for</span> loop move on to the next filename when it comes across a non-CSV file.</p>
<p class="indent">Just so there&#8217;s <em>some</em> output as the program runs, print out a message saying which CSV file the program is working on. Then, add some <span class="literal">TODO</span> comments for what the rest of the program should do.</p>
<h4 class="h4" id="ch16lev2sec7"><strong><em>Step 2: Read in the CSV File</em></strong></h4>
<p class="noindent">The program doesn&#8217;t remove the first line from the CSV file. Rather, it creates a new copy of the CSV file without the first line. Since the copy&#8217;s filename is the same as the original filename, the copy will overwrite the original.</p>
<p class="indent">The program will need a way to track whether it is currently looping on the first row. Add the following to <em>removeCsvHeader.py</em>.</p>
<p class="programs">#! python3<br/>
# removeCsvHeader.py - Removes the header from all CSV files in the current <br/>
# working directory.<br/><br/>
--<span class="codeitalic1">snip</span>--<br/><br/>
<span class="codestrong1">&#160;&#160;&#160;&#160;# Read the CSV file in (skipping first row).</span><br/>
&#160;&#160;&#160;&#160;<span class="codestrong1">csvRows = []</span><br/>
&#160;&#160;&#160;&#160;<span class="codestrong1">csvFileObj = open(csvFilename)</span><br/>
<span class="codestrong1">&#160;&#160;&#160;&#160;readerObj = csv.reader(csvFileObj)</span><br/>
&#160;&#160;&#160;&#160;<span class="codestrong1">for row in readerObj:</span><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="codestrong1">if readerObj.line_num == 1:</span><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="codestrong1">continue&#160;&#160;&#160;&#160;# skip first row</span><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="codestrong1">csvRows.append(row)</span><br/>
&#160;&#160;&#160;&#160;<span class="codestrong1">csvFileObj.close()</span><br/><br/>
&#160;&#160;&#160;&#160;# TODO: Write out the CSV file.</p>
<p class="indent"><span epub:type="pagebreak" id="page_380"/>The <span class="literal">reader</span> object&#8217;s <span class="literal">line_num</span> attribute can be used to determine which line in the CSV file it is currently reading. Another <span class="literal">for</span> loop will loop over the rows returned from the CSV <span class="literal">reader</span> object, and all rows but the first will be appended to <span class="literal">csvRows</span>.</p>
<p class="indent">As the <span class="literal">for</span> loop iterates over each row, the code checks whether <span class="literal">readerObj.line_num</span> is set to <span class="literal">1</span>. If so, it executes a <span class="literal">continue</span> to move on to the next row without appending it to <span class="literal">csvRows</span>. For every row afterward, the condition will be always be <span class="literal">False</span>, and the row will be appended to <span class="literal">csvRows</span>.</p>
<h4 class="h4" id="ch16lev2sec8"><strong><em>Step 3: Write Out the CSV File Without the First Row</em></strong></h4>
<p class="noindent">Now that <span class="literal">csvRows</span> contains all rows but the first row, the list needs to be written out to a CSV file in the <em>headerRemoved</em> folder. Add the following to <em>removeCsvHeader.py</em>:</p>
<p class="programs">&#160;&#160;&#160;#! python3<br/>
&#160;&#160;&#160;# removeCsvHeader.py - Removes the header from all CSV files in the current <br/>
&#160;&#160;&#160;# working directory.<br/><br/>
&#160;&#160;&#160;--<span class="codeitalic1">snip</span>--<br/><br/>
&#160;&#160;&#160;# Loop through every file in the current working directory.<br/>
<span class="ent">&#x278A;</span> for csvFilename in os.listdir('.'):<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not csvFilename.endswith('.csv'):<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;continue&#160;&#160;&#160;&#160;# skip non-CSV files<br/><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;--<span class="codeitalic1">snip</span>--<br/><br/>
<span class="codestrong1">&#160;&#160;&#160;&#160;&#160;&#160;&#160;# Write out the CSV file.</span><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="codestrong1">csvFileObj = open(os.path.join('headerRemoved', csvFilename), 'w',</span><br/>
<span class="codestrong1">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;newline='')</span><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="codestrong1">csvWriter = csv.writer(csvFileObj)</span><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="codestrong1">for row in csvRows:</span><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="codestrong1">csvWriter.writerow(row)</span><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="codestrong1">csvFileObj.close()</span></p>
<p class="indent">The CSV <span class="literal">writer</span> object will write the list to a CSV file in <span class="literal">headerRemoved</span> using <span class="literal">csvFilename</span> (which we also used in the CSV reader). This will overwrite the original file.</p>
<p class="indent">Once we create the <span class="literal">writer</span> object, we loop over the sublists stored in <span class="literal">csvRows</span> and write each sublist to the file.</p>
<p class="indent">After the code is executed, the outer <span class="literal">for</span> loop <span class="ent">&#x278A;</span> will loop to the next filename from <span class="literal">os.listdir('.')</span>. When that loop is finished, the program will be complete.</p>
<p class="indent">To test your program, download <em>removeCsvHeader.zip</em> from <em><a href="https://nostarch.com/automatestuff2/">https://nostarch.com/automatestuff2/</a></em> and unzip it to a folder. Run the <em>removeCsvHeader.py</em> program in that folder. The output will look like this:</p>
<p class="programs">Removing header from NAICS_data_1048.csv...<br/>
Removing header from NAICS_data_1218.csv...<br/>
--<span class="codeitalic1">snip</span>--<br/>
<span epub:type="pagebreak" id="page_381"/>Removing header from NAICS_data_9834.csv...<br/>
Removing header from NAICS_data_9986.csv...</p>
<p class="indent">This program should print a filename each time it strips the first line from a CSV file.</p>
<h4 class="h4" id="ch16lev2sec9"><strong><em>Ideas for Similar Programs</em></strong></h4>
<p class="noindent">The programs that you could write for CSV files are similar to the kinds you could write for Excel files, since they&#8217;re both spreadsheet files. You could write programs to do the following:</p>
<ul>
<li class="noindent">Compare data between different rows in a CSV file or between multiple CSV files.</li>
<li class="noindent">Copy specific data from a CSV file to an Excel file, or vice versa.</li>
<li class="noindent">Check for invalid data or formatting mistakes in CSV files and alert the user to these errors.</li>
<li class="noindent">Read data from a CSV file as input for your Python programs.</li>
</ul>
<h3 class="h3" id="ch16lev1sec3"><strong>JSON and APIs</strong></h3>
<p class="noindent">JavaScript Object Notation is a popular way to format data as a single human-readable string. JSON is the native way that JavaScript programs write their data structures and usually resembles what Python&#8217;s <span class="literal">pprint()</span> function would produce. You don&#8217;t need to know JavaScript in order to work with JSON-formatted data.</p>
<p class="indent">Here&#8217;s an example of data formatted as JSON:</p>
<p class="programs">{"name": "Zophie", "isCat": true, <br/>
&#160;"miceCaught": 0, "napsTaken": 37.5, <br/>
&#160;"felineIQ": null}</p>
<p class="indent">JSON is useful to know, because many websites offer JSON content as a way for programs to interact with the website. This is known as providing an <em>application programming interface (API)</em>. Accessing an API is the same as accessing any other web page via a URL. The difference is that the data returned by an API is formatted (with JSON, for example) for machines; APIs aren&#8217;t easy for people to read.</p>
<p class="indent">Many websites make their data available in JSON format. Facebook, Twitter, Yahoo, Google, Tumblr, Wikipedia, Flickr, Data.gov, Reddit, IMDb, Rotten Tomatoes, LinkedIn, and many other popular sites offer APIs for programs to use. Some of these sites require registration, which is almost always free. You&#8217;ll have to find documentation for what URLs your program needs to request in order to get the data you want, as well as the general format of the JSON data structures that are returned. This documentation should be provided by whatever site is offering the API; if they have a &#8220;Developers&#8221; page, look for the documentation there.</p>
<p class="indent"><span epub:type="pagebreak" id="page_382"/>Using APIs, you could write programs that do the following:</p>
<ul>
<li class="noindent">Scrape raw data from websites. (Accessing APIs is often more convenient than downloading web pages and parsing HTML with Beautiful Soup.)</li>
<li class="noindent">Automatically download new posts from one of your social network accounts and post them to another account. For example, you could take your Tumblr posts and post them to Facebook.</li>
<li class="noindent">Create a &#8220;movie encyclopedia&#8221; for your personal movie collection by pulling data from IMDb, Rotten Tomatoes, and Wikipedia and putting it into a single text file on your computer.</li>
</ul>
<p class="indent">You can see some examples of JSON APIs in the resources at <em><a href="https://nostarch.com/automatestuff2/">https://nostarch.com/automatestuff2/</a></em>.</p>
<p class="indent">JSON isn&#8217;t the only way to format data into a human-readable string. There are many others, including XML (eXtensible Markup Language), TOML (Tom&#8217;s Obvious, Minimal Language), YML (Yet another Markup Language), INI (Initialization), or even the outdated ASN.1 (Abstract Syntax Notation One) formats, all of which provide a structure for representing data as human-readable text. This book won&#8217;t cover these, because JSON has quickly become the most widely used alternate format, but there are third-party Python modules that readily handle them.</p>
<h3 class="h3" id="ch16lev1sec4"><strong>The json Module</strong></h3>
<p class="noindent">Python&#8217;s <span class="literal">json</span> module handles all the details of translating between a string with JSON data and Python values for the <span class="literal">json.loads()</span> and <span class="literal">json.dumps()</span> functions. JSON can&#8217;t store <em>every</em> kind of Python value. It can contain values of only the following data types: strings, integers, floats, Booleans, lists, dictionaries, and <span class="literal">NoneType</span>. JSON cannot represent Python-specific objects, such as <span class="literal">File</span> objects, CSV <span class="literal">reader</span> or <span class="literal">writer</span> objects, <span class="literal">Regex</span> objects, or Selenium <span class="literal">WebElement</span> objects.</p>
<h4 class="h4" id="ch16lev2sec10"><strong><em>Reading JSON with the loads() Function</em></strong></h4>
<p class="noindent">To translate a string containing JSON data into a Python value, pass it to the <span class="literal">json.loads()</span> function. (The name means &#8220;load string,&#8221; not &#8220;loads.&#8221;) Enter the following into the interactive shell:</p>
<p class="programs">&gt;&gt;&gt; <span class="codestrong1">stringOfJsonData = '{"name": "Zophie", "isCat": true, "miceCaught": 0,</span><br/>
<span class="codestrong1">"felineIQ": null}'</span><br/>
&gt;&gt;&gt; <span class="codestrong1">import json</span><br/>
&gt;&gt;&gt; <span class="codestrong1">jsonDataAsPythonValue = json.loads(stringOfJsonData)</span><br/>
&gt;&gt;&gt; <span class="codestrong1">jsonDataAsPythonValue</span><br/>
{'isCat': True, 'miceCaught': 0, 'name': 'Zophie', 'felineIQ': None}</p>
<p class="indent">After you import the <span class="literal">json</span> module, you can call <span class="literal">loads()</span> and pass it a string of JSON data. Note that JSON strings always use double quotes. It will return that data as a Python dictionary. Python dictionaries are not <span epub:type="pagebreak" id="page_383"/>ordered, so the key-value pairs may appear in a different order when you print <span class="literal">jsonDataAsPythonValue</span>.</p>
<h4 class="h4" id="ch16lev2sec11"><strong><em>Writing JSON with the dumps() Function</em></strong></h4>
<p class="noindent">The <span class="literal">json.dumps()</span> function (which means &#8220;dump string,&#8221; not &#8220;dumps&#8221;) will translate a Python value into a string of JSON-formatted data. Enter the following into the interactive shell:</p>
<p class="programs">&gt;&gt;&gt; <span class="codestrong1">pythonValue = {'isCat': True, 'miceCaught': 0, 'name': 'Zophie',</span><br/>
<span class="codestrong1">'felineIQ': None}</span><br/>
&gt;&gt;&gt; <span class="codestrong1">import json</span><br/>
&gt;&gt;&gt; <span class="codestrong1">stringOfJsonData = json.dumps(pythonValue)</span><br/>
&gt;&gt;&gt; <span class="codestrong1">stringOfJsonData</span><br/>
'{"isCat": true, "felineIQ": null, "miceCaught": 0, "name": "Zophie" }'</p>
<p class="indent">The value can only be one of the following basic Python data types: dictionary, list, integer, float, string, Boolean, or <span class="literal">None</span>.</p>
<h3 class="h3" id="ch16lev1sec5"><strong>Project: Fetching Current Weather Data</strong></h3>
<p class="noindent">Checking the weather seems fairly trivial: Open your web browser, click the address bar, type the URL to a weather website (or search for one and then click the link), wait for the page to load, look past all the ads, and so on.</p>
<p class="indent">Actually, there are a lot of boring steps you could skip if you had a program that downloaded the weather forecast for the next few days and printed it as plaintext. This program uses the <span class="literal">requests</span> module from <a href="ch12.xhtml#ch12">Chapter 12</a> to download data from the web.</p>
<p class="indent">Overall, the program does the following:</p>
<ol>
<li class="noindent">Reads the requested location from the command line</li>
<li class="noindent">Downloads JSON weather data from OpenWeatherMap.org</li>
<li class="noindent">Converts the string of JSON data to a Python data structure</li>
<li class="noindent">Prints the weather for today and the next two days</li>
</ol>
<p class="indent">So the code will need to do the following:</p>
<ol>
<li class="noindent">Join strings in <span class="literal">sys.argv</span> to get the location.</li>
<li class="noindent">Call <span class="literal">requests.get()</span> to download the weather data.</li>
<li class="noindent">Call <span class="literal">json.loads()</span> to convert the JSON data to a Python data structure.</li>
<li class="noindent">Print the weather forecast.</li>
</ol>
<p class="indent">For this project, open a new file editor window and save it as <em>getOpenWeather.py</em>. Then visit <em><a href="https://openweathermap.org/api/">https://openweathermap.org/api/</a></em> in your browser and sign up for a free account to obtain an <em>API key</em>, also called an app ID, which for the OpenWeatherMap service is a string code that looks something like <span class="literal">'30144aba38018987d84710d0e319281e'</span>. You don&#8217;t need to pay for this service <span epub:type="pagebreak" id="page_384"/>unless you plan on making more than 60 API calls per minute. Keep the API key secret; anyone who knows it can write scripts that use your account&#8217;s usage quota.</p>
<h4 class="h4" id="ch16lev2sec12"><strong><em>Step 1: Get Location from the Command Line Argument</em></strong></h4>
<p class="noindent">The input for this program will come from the command line. Make <em>getOpenWeather.py</em> look like this:</p>
<p class="programs">#! python3<br/>
# getOpenWeather.py - Prints the weather for a location from the command line.<br/><br/>
APPID = 'YOUR_APPID_HERE'<br/><br/>
import json, requests, sys<br/><br/>
# Compute location from command line arguments.<br/>
if len(sys.argv) &lt; 2:<br/>
&#160;&#160;&#160;&#160;print('Usage: getOpenWeather.py city_name, 2-letter_country_code')<br/>
&#160;&#160;&#160;&#160;sys.exit()<br/>
location = ' '.join(sys.argv[1:])<br/><br/>
# TODO: Download the JSON data from OpenWeatherMap.org's API.<br/><br/>
# TODO: Load JSON data into a Python variable.</p>
<p class="indent">In Python, command line arguments are stored in the <span class="literal">sys.argv</span> list. The <span class="literal">APPID</span> variable should be set to the API key for your account. Without this key, your requests to the weather service will fail. After the <span class="literal">#!</span> shebang line and <span class="literal">import</span> statements, the program will check that there is more than one command line argument. (Recall that <span class="literal">sys.argv</span> will always have at least one element, <span class="literal">sys.argv[0]</span>, which contains the Python script&#8217;s filename.) If there is only one element in the list, then the user didn&#8217;t provide a location on the command line, and a &#8220;usage&#8221; message will be provided to the user before the program ends.</p>
<p class="indent">The OpenWeatherMap service requires that the query be formatted as the city name, a comma, and a two-letter country code (like &#8220;US&#8221; for the United States). You can find a list of these codes at <em><a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2">https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2</a></em>. Our script displays the weather for the first city listed in the retrieved JSON text. Unfortunately, cities that share a name, like Portland, Oregon, and Portland, Maine, will both be included, though the JSON text will include longitude and latitude information to differentiate between the cities.</p>
<p class="indent">Command line arguments are split on spaces. The command line argument <span class="literal">San Francisco, US</span> would make <span class="literal">sys.argv</span> hold <span class="literal">['getOpenWeather.py', 'San', 'Francisco,', 'US']</span>. Therefore, call the <span class="literal">join()</span> method to join all the strings except for the first in <span class="literal">sys.argv</span>. Store this joined string in a variable named <span class="literal">location</span>.</p>
<h4 class="h4" id="ch16lev2sec13"><span epub:type="pagebreak" id="page_385"/><strong><em>Step 2: Download the JSON Data</em></strong></h4>
<p class="noindent"><em>OpenWeatherMap.org</em> provides real-time weather information in JSON format. First you must sign up for a free API key on the site. (This key is used to limit how frequently you make requests on their server, to keep their bandwidth costs down.) Your program simply has to download the page at <em>https://api.openweathermap.org/data/2.5/forecast/daily?q=&lt;Location&gt;&amp;cnt=3&amp;APPID=&lt;APIkey&gt;</em>, where <em>&lt;Location&gt;</em> is the name of the city whose weather you want and <em>&lt;API key&gt;</em> is your personal API key. Add the following to <em>getOpenWeather.py</em>.</p>
<p class="programs">#! python3<br/>
# getOpenWeather.py - Prints the weather for a location from the command line.<br/><br/>
--<span class="codeitalic1">snip</span>--<br/><br/>
<span class="codestrong1"># Download the JSON data from OpenWeatherMap.org's API.</span><br/>
<span class="codestrong1">url ='https://api.openweathermap.org/data/2.5/forecast/daily?q=%s&amp;cnt=3&amp;APPID=%s ' % (location,</span><br/>
<span class="codestrong1">APPID)</span><br/>
<span class="codestrong1">response = requests.get(url)</span><br/>
<span class="codestrong1">response.raise_for_status()</span><br/><br/>
<span class="codestrong1"># Uncomment to see the raw JSON text:</span><br/>
<span class="codestrong1">#print(response.text)&#160;&#160;&#160;&#160;</span><br/><br/>
# TODO: Load JSON data into a Python variable.</p>
<p class="indent">We have <span class="literal">location</span> from our command line arguments. To make the URL we want to access, we use the <span class="literal">%s</span> placeholder and insert whatever string is stored in <span class="literal">location</span> into that spot in the URL string. We store the result in <span class="literal">url</span> and pass <span class="literal">url</span> to <span class="literal">requests.get()</span>. The <span class="literal">requests.get()</span> call returns a <span class="literal">Response</span> object, which you can check for errors by calling <span class="literal">raise_for_status()</span>. If no exception is raised, the downloaded text will be in <span class="literal">response.text</span>.</p>
<h4 class="h4" id="ch16lev2sec14"><strong><em>Step 3: Load JSON Data and Print Weather</em></strong></h4>
<p class="noindent">The <span class="literal">response.text</span> member variable holds a large string of JSON-formatted data. To convert this to a Python value, call the <span class="literal">json.loads()</span> function. The JSON data will look something like this:</p>
<p class="programs">{'city': {'coord': {'lat': 37.7771, 'lon': -122.42},<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;'country': 'United States of America',<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;'id': '5391959',<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;'name': 'San Francisco',<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;'population': 0},<br/>
&#160;'cnt': 3,<br/>
&#160;'cod': '200',<br/>
&#160;'list': [{'clouds': 0,<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;'deg': 233,<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;'dt': 1402344000,<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;'humidity': 58,<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;'pressure': 1012.23,<br/>
<span epub:type="pagebreak" id="page_386"/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;'speed': 1.96,<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;'temp': {'day': 302.29,<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;'eve': 296.46,<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;'max': 302.29,<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;'min': 289.77,<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;'morn': 294.59,<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;'night': 289.77},<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;'weather': [{'description': 'sky is clear',<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;'icon': '01d',<br/>
--<span class="codeitalic1">snip</span>--</p>
<p class="indent">You can see this data by passing <span class="literal">weatherData</span> to <span class="literal">pprint.pprint()</span>. You may want to check <em><a href="https://openweathermap.org/">https://openweathermap.org/</a></em> for more documentation on what these fields mean. For example, the online documentation will tell you that the <span class="literal">302.29</span> after <span class="literal">'day'</span> is the daytime temperature in Kelvin, not Celsius or Fahrenheit.</p>
<p class="indent">The weather descriptions you want are after <span class="literal">'main'</span> and <span class="literal">'description'</span>. To neatly print them out, add the following to <em>getOpenWeather.py</em>.</p>
<p class="programs">&#160;&#160;&#160;! python3<br/>
&#160;&#160;&#160;# getOpenWeather.py - Prints the weather for a location from the command line.<br/><br/>
&#160;&#160;&#160;--<span class="codeitalic1">snip</span>--<br/><br/>
&#160;&#160;&#160;<span class="codestrong1"># Load JSON data into a Python variable.</span><br/>
&#160;&#160;&#160;<span class="codestrong1">weatherData = json.loads(response.text)</span><br/><br/>
&#160;&#160;&#160;<span class="codestrong1"># Print weather descriptions.</span><br/>
<span class="ent">&#x278A;</span> <span class="codestrong1">w = weatherData['list']</span><br/>
&#160;&#160;&#160;<span class="codestrong1">print('Current weather in %s:' % (location))</span><br/>
&#160;&#160;&#160;<span class="codestrong1">print(w[0]['weather'][0]['main'], '-', w[0]['weather'][0]['description'])</span><br/>
&#160;&#160;&#160;<span class="codestrong1">print()</span><br/>
&#160;&#160;&#160;<span class="codestrong1">print('Tomorrow:')</span><br/>
&#160;&#160;&#160;<span class="codestrong1">print(w[1]['weather'][0]['main'], '-', w[1]['weather'][0]['description'])</span><br/>
&#160;&#160;&#160;<span class="codestrong1">print()</span><br/>
&#160;&#160;&#160;<span class="codestrong1">print('Day after tomorrow:')</span><br/>
&#160;&#160;&#160;<span class="codestrong1">print(w[2]['weather'][0]['main'], '-', w[2]['weather'][0]['description'])</span></p>
<p class="indent">Notice how the code stores <span class="literal">weatherData['list']</span> in the variable <span class="literal">w</span> to save you some typing <span class="ent">&#x278A;</span>. You use <span class="literal">w[0]</span>, <span class="literal">w[1]</span>, and <span class="literal">w[2]</span> to retrieve the dictionaries for today, tomorrow, and the day after tomorrow&#8217;s weather, respectively. Each of these dictionaries has a <span class="literal">'weather'</span> key, which contains a list value. You&#8217;re interested in the first list item, a nested dictionary with several more keys, at index 0. Here, we print the values stored in the <span class="literal">'main'</span> and <span class="literal">'description'</span> keys, separated by a hyphen.</p>
<p class="indent">When this program is run with the command line argument <span class="literal">getOpenWeather.py San Francisco, CA</span>, the output looks something like this:</p>
<p class="programs">Current weather in San Francisco, CA:<br/>
Clear - sky is clear<br/><br/>
<span epub:type="pagebreak" id="page_387"/>Tomorrow:<br/>
Clouds - few clouds<br/><br/>
Day after tomorrow:<br/>
Clear - sky is clear</p>
<p class="indent">(The weather is one of the reasons I like living in San Francisco!)</p>
<h4 class="h4" id="ch16lev2sec15"><strong><em>Ideas for Similar Programs</em></strong></h4>
<p class="noindent">Accessing weather data can form the basis for many types of programs. You can create similar programs to do the following:</p>
<ul>
<li class="noindent">Collect weather forecasts for several campsites or hiking trails to see which one will have the best weather.</li>
<li class="noindent">Schedule a program to regularly check the weather and send you a frost alert if you need to move your plants indoors. (<a href="ch17.xhtml#ch17">Chapter 17</a> covers scheduling, and <a href="ch18.xhtml#ch18">Chapter 18</a> explains how to send email.)</li>
<li class="noindent">Pull weather data from multiple sites to show all at once, or calculate and show the average of the multiple weather predictions.</li>
</ul>
<h3 class="h3" id="ch16lev1sec6"><strong>Summary</strong></h3>
<p class="noindent">CSV and JSON are common plaintext formats for storing data. They are easy for programs to parse while still being human readable, so they are often used for simple spreadsheets or web app data. The <span class="literal">csv</span> and <span class="literal">json</span> modules greatly simplify the process of reading and writing to CSV and JSON files.</p>
<p class="indent">The last few chapters have taught you how to use Python to parse information from a wide variety of file formats. One common task is taking data from a variety of formats and parsing it for the particular information you need. These tasks are often specific to the point that commercial software is not optimally helpful. By writing your own scripts, you can make the computer handle large amounts of data presented in these formats.</p>
<p class="indent">In <a href="ch18.xhtml#ch18">Chapter 18</a>, you&#8217;ll break away from data formats and learn how to make your programs communicate with you by sending emails and text messages.</p>
<h3 class="h3" id="ch16lev1sec7"><strong>Practice Questions</strong></h3>
<p class="question"><a id="ch16que1" href="app03.xhtml#ch16ans1">1</a>. What are some features Excel spreadsheets have that CSV spread-sheets don&#8217;t?</p>
<p class="question"><a id="ch16que2" href="app03.xhtml#ch16ans2">2</a>. What do you pass to <span class="literal">csv.reader()</span> and <span class="literal">csv.writer()</span> to create <span class="literal">reader</span> and <span class="literal">writer</span> objects?</p>
<p class="question"><a id="ch16que3" href="app03.xhtml#ch16ans3">3</a>. What modes do <span class="literal">File</span> objects for <span class="literal">reader</span> and <span class="literal">writer</span> objects need to be opened in?</p>
<p class="question"><a id="ch16que4" href="app03.xhtml#ch16ans4">4</a>. <span epub:type="pagebreak" id="page_388"/>What method takes a list argument and writes it to a CSV file?</p>
<p class="question"><a id="ch16que5" href="app03.xhtml#ch16ans5">5</a>. What do the <span class="literal">delimiter</span> and <span class="literal">lineterminator</span> keyword arguments do?</p>
<p class="question"><a id="ch16que6" href="app03.xhtml#ch16ans6">6</a>. What function takes a string of JSON data and returns a Python data structure?</p>
<p class="question"><a id="ch16que7" href="app03.xhtml#ch16ans7">7</a>. What function takes a Python data structure and returns a string of JSON data?</p>
<h3 class="h3" id="ch16lev1sec8"><strong>Practice Project</strong></h3>
<p class="noindent">For practice, write a program that does the following.</p>
<h4 class="h4" id="ch16lev2sec16"><strong><em>Excel-to-CSV Converter</em></strong></h4>
<p class="noindent">Excel can save a spreadsheet to a CSV file with a few mouse clicks, but if you had to convert hundreds of Excel files to CSVs, it would take hours of clicking. Using the <span class="literal">openpyxl</span> module from <a href="ch12.xhtml#ch12">Chapter 12</a>, write a program that reads all the Excel files in the current working directory and outputs them as CSV files.</p>
<p class="indent">A single Excel file might contain multiple sheets; you&#8217;ll have to create one CSV file per <em>sheet</em>. The filenames of the CSV files should be <em>&lt;excel filename&gt;_&lt;sheet title&gt;.csv</em>, where <em>&lt;excel filename&gt;</em> is the filename of the Excel file without the file extension (for example, <span class="literal">'spam_data'</span>, not <span class="literal">'spam_data.xlsx'</span>) and <em>&lt;sheet title&gt;</em> is the string from the <span class="literal">Worksheet</span> object&#8217;s <span class="literal">title</span> variable.</p>
<p class="indent">This program will involve many nested <span class="literal">for</span> loops. The skeleton of the program will look something like this:</p>
<p class="programs">for excelFile in os.listdir('.'):<br/>
&#160;&#160;&#160;&#160;# Skip non-xlsx files, load the workbook object.<br/>
&#160;&#160;&#160;&#160;for sheetName in wb.get_sheet_names():<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# Loop through every sheet in the workbook.<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sheet = wb.get_sheet_by_name(sheetName)<br/><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# Create the CSV filename from the Excel filename and sheet title.<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# Create the csv.writer object for this CSV file.<br/><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# Loop through every row in the sheet.<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for rowNum in range(1, sheet.max_row + 1):<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;rowData = []&#160;&#160;&#160;&#160;# append each cell to this list<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# Loop through each cell in the row.<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for colNum in range(1, sheet.max_column + 1):<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# Append each cell's data to rowData.<br/><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;# Write the rowData list to the CSV file.<br/><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;csvFile.close()</p>
<p class="indent">Download the ZIP file <em>excelSpreadsheets.zip</em> from <em><a href="https://nostarch.com/automatestuff2/">https://nostarch.com/automatestuff2/</a></em> and unzip the spreadsheets into the same directory as your program. You can use these as the files to test the program on.</p>
</body>
</html>
