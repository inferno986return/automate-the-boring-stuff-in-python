<?xml version="1.0" encoding="UTF-8"?>
<html xml:lang="en-us" lang="en-us" xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" xmlns:ns="http://www.w3.org/2001/10/synthesis">
<head>
<title>Automate the Boring Stuff with Python: Practical Programming for Total Beginners, 2nd Edition</title>
<link rel="stylesheet" type="text/css" href="../styles/9781593279936.css"/>
</head>
<body>
<h2 class="h2" id="ch15"><span epub:type="pagebreak" id="page_347"/><strong><span class="big">15</span><br/>WORKING WITH PDF AND WORD DOCUMENTS</strong></h2>
<div class="image1"><img src="../images/15fig00.jpg" alt="Image"/></div>
<p class="noindent">PDF and Word documents are binary files, which makes them much more complex than plaintext files. In addition to text, they store lots of font, color, and layout information. If you want your programs to read or write to PDFs or Word documents, you&#8217;ll need to do more than simply pass their filenames to <span class="literal">open()</span>.</p>
<p class="indent">Fortunately, there are Python modules that make it easy for you to interact with PDFs and Word documents. This chapter will cover two such modules: PyPDF2 and Python-Docx.</p>
<h3 class="h3" id="ch15lev1sec1"><strong>PDF Documents</strong></h3>
<p class="noindent"><em>PDF</em> stands for <em>Portable Document Format</em> and uses the <em>.pdf</em> file extension. Although PDFs support many features, this chapter will focus on the two things you&#8217;ll be doing most often with them: reading text content from PDFs and crafting new PDFs from existing documents.</p>
<p class="indent"><span epub:type="pagebreak" id="page_348"/>The module you&#8217;ll use to work with PDFs is PyPDF2 version 1.26.0. It&#8217;s important that you install this version because future versions of PyPDF2 may be incompatible with the code. To install it, run <span class="literal">pip install --user PyPDF2==1.26.0</span> from the command line. This module name is case sensitive, so make sure the <em>y</em> is lowercase and everything else is uppercase. (Check out <a href="app01.xhtml#app01">Appendix A</a> for full details about installing third-party modules.) If the module was installed correctly, running <span class="literal">import PyPDF2</span> in the interactive shell shouldn&#8217;t display any errors.</p>
<div class="sidebar">
<p class="sidebart"><strong>THE PROBLEMATIC PDF FORMAT</strong></p>
<p class="spara">While PDF files are great for laying out text in a way that&#8217;s easy for people to print and read, they&#8217;re not straightforward for software to parse into plaintext. As a result, PyPDF2 might make mistakes when extracting text from a PDF and may even be unable to open some PDFs at all. There isn&#8217;t much you can do about this, unfortunately. PyPDF2 may simply be unable to work with some of your particular PDF files. That said, I haven&#8217;t found any PDF files so far that can&#8217;t be opened with PyPDF2.</p>
</div>
<h4 class="h4" id="ch15lev2sec1"><strong><em>Extracting Text from PDFs</em></strong></h4>
<p class="noindent">PyPDF2 does not have a way to extract images, charts, or other media from PDF documents, but it can extract text and return it as a Python string. To start learning how PyPDF2 works, we&#8217;ll use it on the example PDF shown in <a href="ch15.xhtml#ch15fig01">Figure 15-1</a>.</p>
<div class="image"><a id="ch15fig01"/><img src="../images/15fig01.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 15-1: The PDF page that we will be extracting text from</em></p>
<p class="indent"><span epub:type="pagebreak" id="page_349"/>Download this PDF from <em><a href="https://nostarch.com/automatestuff2/">https://nostarch.com/automatestuff2/</a></em> and enter the following into the interactive shell:</p>
<p class="programs">&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">import PyPDF2</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdfFileObj = open('meetingminutes.pdf', 'rb')</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdfReader = PyPDF2.PdfFileReader(pdfFileObj)</span><br/>
<span class="ent">&#x278A;</span> &gt;&gt;&gt; <span class="codestrong1">pdfReader.numPages</span><br/>
&#160;&#160;&#160;19<br/>
<span class="ent">&#x278B;</span> &gt;&gt;&gt; <span class="codestrong1">pageObj = pdfReader.getPage(0)</span><br/>
<span class="ent">&#x278C;</span> &gt;&gt;&gt; <span class="codestrong1">pageObj.extractText()</span><br/>
&#160;&#160;&#160;'OOFFFFIICCIIAALL&#160;&#160;BBOOAARRDD&#160;&#160;MMIINNUUTTEESS&#160;&#160;&#160;Meeting of March 7,<br/>
&#160;&#160;&#160;2015&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;\n&#160;&#160;&#160;&#160;&#160;The Board of Elementary and Secondary Education shall<br/>
&#160;&#160;&#160;provide leadership and create policies for education that expand opportunities<br/>
&#160;&#160;&#160;for children, empower families and communities, and advance Louisiana in an<br/>
&#160;&#160;&#160;increasingly competitive global market. BOARD&#160;&#160;of ELEMENTARY and&#160;&#160;SECONDARY<br/>
&#160;&#160;&#160;EDUCATION&#160;&#160;'<br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdfFileObj.close()</span></p>
<p class="indent">First, import the <span class="literal">PyPDF2</span> module. Then open <em>meetingminutes.pdf</em> in read binary mode and store it in <span class="literal">pdfFileObj</span>. To get a <span class="literal">PdfFileReader</span> object that represents this PDF, call <span class="literal">PyPDF2.PdfFileReader()</span> and pass it <span class="literal">pdfFileObj</span>. Store this <span class="literal">PdfFileReader</span> object in <span class="literal">pdfReader</span>.</p>
<p class="indent">The total number of pages in the document is stored in the <span class="literal">numPages</span> attribute of a <span class="literal">PdfFileReader</span> object <span class="ent">&#x278A;</span>. The example PDF has 19 pages, but let&#8217;s extract text from only the first page.</p>
<p class="indent">To extract text from a page, you need to get a <span class="literal">Page</span> object, which represents a single page of a PDF, from a <span class="literal">PdfFileReader</span> object. You can get a <span class="literal">Page</span> object by calling the <span class="literal">getPage()</span> method <span class="ent">&#x278B;</span> on a <span class="literal">PdfFileReader</span> object and passing it the page number of the page you&#8217;re interested in&#8212;in our case, 0.</p>
<p class="indent">PyPDF2 uses a <em>zero-based index</em> for getting pages: The first page is page 0, the second is <a href="part01.xhtml#page_1">page 1</a>, and so on. This is always the case, even if pages are numbered differently within the document. For example, say your PDF is a three-page excerpt from a longer report, and its pages are numbered 42, 43, and 44. To get the first page of this document, you would want to call <span class="literal">pdfReader.getPage(0)</span>, not <span class="literal">getPage(42)</span> or <span class="literal">getPage(1)</span>.</p>
<p class="indent">Once you have your <span class="literal">Page</span> object, call its <span class="literal">extractText()</span> method to return a string of the page&#8217;s text <span class="ent">&#x278C;</span>. The text extraction isn&#8217;t perfect: The text <em>Charles E. &#8220;Chas&#8221; Roemer, President</em> from the PDF is absent from the string returned by <span class="literal">extractText()</span>, and the spacing is sometimes off. Still, this approximation of the PDF text content may be good enough for your program.</p>
<h4 class="h4" id="ch15lev2sec2"><strong><em>Decrypting PDFs</em></strong></h4>
<p class="noindent">Some PDF documents have an encryption feature that will keep them from being read until whoever is opening the document provides a password. Enter the following into the interactive shell with the PDF you downloaded, which has been encrypted with the password <em>rosebud</em>:</p>
<p class="programs">&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">import PyPDF2</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdfReader = PyPDF2.PdfFileReader(open('encrypted.pdf', 'rb'))</span><br/>
<span epub:type="pagebreak" id="page_350"/><span class="ent">&#x278A;</span> &gt;&gt;&gt; <span class="codestrong1">pdfReader.isEncrypted</span><br/>
&#160;&#160;&#160;True<br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdfReader.getPage(0)</span><br/>
<span class="ent">&#x278B;</span> Traceback (most recent call last):<br/>
&#160;&#160;&#160;&#160;&#160;File "&lt;pyshell#173&gt;", line 1, in &lt;module&gt;<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;pdfReader.getPage()<br/>
&#160;&#160;&#160;&#160;&#160;--<span class="codeitalic1">snip</span>--<br/>
&#160;&#160;&#160;&#160;&#160;File "C:\Python34\lib\site-packages\PyPDF2\pdf.py", line 1173, in getObject<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;raise utils.PdfReadError("file has not been decrypted")<br/>
&#160;&#160;&#160;PyPDF2.utils.PdfReadError: file has not been decrypted<br/>
&gt;&gt;&gt; <span class="codestrong1">pdfReader = PyPDF2.PdfFileReader(open('encrypted.pdf', 'rb'))</span><br/>
<span class="ent">&#x278C;</span> &gt;&gt;&gt; <span class="codestrong1">pdfReader.decrypt('rosebud')</span><br/>
&#160;&#160;&#160;1<br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pageObj = pdfReader.getPage(0)</span></p>
<p class="indent">All <span class="literal">PdfFileReader</span> objects have an <span class="literal">isEncrypted</span> attribute that is <span class="literal">True</span> if the PDF is encrypted and <span class="literal">False</span> if it isn&#8217;t <span class="ent">&#x278A;</span>. Any attempt to call a function that reads the file before it has been decrypted with the correct password will result in an error <span class="ent">&#x278B;</span>.</p>
<div class="note">
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>
<p class="notep"><em>Due to a bug in PyPDF2 version 1.26.0, calling <span class="codeitalic">getPage()</span> on an encrypted PDF before calling <span class="codeitalic">decrypt()</span> on it causes future <span class="codeitalic">getPage()</span> calls to fail with the following error: <span class="codeitalic">IndexError: list index out of range</span>. This is why our example reopened the file with a new <span class="codeitalic">PdfFileReader</span> object.</em></p>
</div>
<p class="indent">To read an encrypted PDF, call the <span class="literal">decrypt()</span> function and pass the password as a string <span class="ent">&#x278C;</span>. After you call <span class="literal">decrypt()</span> with the correct password, you&#8217;ll see that calling <span class="literal">getPage()</span> no longer causes an error. If given the wrong password, the <span class="literal">decrypt()</span> function will return <span class="literal">0</span> and <span class="literal">getPage()</span> will continue to fail. Note that the <span class="literal">decrypt()</span> method decrypts only the <span class="literal">PdfFileReader</span> object, not the actual PDF file. After your program terminates, the file on your hard drive remains encrypted. Your program will have to call <span class="literal">decrypt()</span> again the next time it is run.</p>
<h4 class="h4" id="ch15lev2sec3"><strong><em>Creating PDFs</em></strong></h4>
<p class="noindent">PyPDF2&#8217;s counterpart to <span class="literal">PdfFileReader</span> is <span class="literal">PdfFileWriter</span>, which can create new PDF files. But PyPDF2 cannot write arbitrary text to a PDF like Python can do with plaintext files. Instead, PyPDF2&#8217;s PDF-writing capabilities are limited to copying pages from other PDFs, rotating pages, overlaying pages, and encrypting files.</p>
<p class="indent">PyPDF2 doesn&#8217;t allow you to directly edit a PDF. Instead, you have to create a new PDF and then copy content over from an existing document. The examples in this section will follow this general approach:</p>
<ol>
<li class="noindent">Open one or more existing PDFs (the source PDFs) into <span class="literal">PdfFileReader</span> objects.</li>
<li class="noindent">Create a new <span class="literal">PdfFileWriter</span> object.</li>
<li class="noindent"><span epub:type="pagebreak" id="page_351"/>Copy pages from the <span class="literal">PdfFileReader</span> objects into the <span class="literal">PdfFileWriter</span> object.</li>
<li class="noindent">Finally, use the <span class="literal">PdfFileWriter</span> object to write the output PDF.</li>
</ol>
<p class="indent">Creating a <span class="literal">PdfFileWriter</span> object creates only a value that represents a PDF document in Python. It doesn&#8217;t create the actual PDF file. For that, you must call the <span class="literal">PdfFileWriter</span>&#8217;s <span class="literal">write()</span> method.</p>
<p class="indent">The <span class="literal">write()</span> method takes a regular <span class="literal">File</span> object that has been opened in <em>write-binary</em> mode. You can get such a <span class="literal">File</span> object by calling Python&#8217;s <span class="literal">open()</span> function with two arguments: the string of what you want the PDF&#8217;s filename to be and <span class="literal">'wb'</span> to indicate the file should be opened in write-binary mode.</p>
<p class="indent">If this sounds a little confusing, don&#8217;t worry&#8212;you&#8217;ll see how this works in the following code examples.</p>
<h5 class="h5" id="ch15lev3sec1"><strong>Copying Pages</strong></h5>
<p class="noindent">You can use PyPDF2 to copy pages from one PDF document to another. This allows you to combine multiple PDF files, cut unwanted pages, or reorder pages.</p>
<p class="indent">Download <em>meetingminutes.pdf</em> and <em>meetingminutes2.pdf</em> from <em><a href="https://nostarch.com/automatestuff2/">https://nostarch.com/automatestuff2/</a></em> and place the PDFs in the current working directory. Enter the following into the interactive shell:</p>
<p class="programs">&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">import PyPDF2</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdf1File = open('meetingminutes.pdf', 'rb')</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdf2File = open('meetingminutes2.pdf', 'rb')</span><br/>
<span class="ent">&#x278A;</span> &gt;&gt;&gt; <span class="codestrong1">pdf1Reader = PyPDF2.PdfFileReader(pdf1File)</span><br/>
<span class="ent">&#x278B;</span> &gt;&gt;&gt; <span class="codestrong1">pdf2Reader = PyPDF2.PdfFileReader(pdf2File)</span><br/>
<span class="ent">&#x278C;</span> &gt;&gt;&gt; <span class="codestrong1">pdfWriter = PyPDF2.PdfFileWriter()</span><br/><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">for pageNum in range(pdf1Reader.numPages):</span><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="ent">&#x278D;</span> <span class="codestrong1">pageObj = pdf1Reader.getPage(pageNum)</span><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="ent">&#x278E;</span> <span class="codestrong1">pdfWriter.addPage(pageObj)</span><br/><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">for pageNum in range(pdf2Reader.numPages):</span><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="ent">&#x278D;</span> <span class="codestrong1">pageObj = pdf2Reader.getPage(pageNum)</span><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="ent">&#x278E;</span> <span class="codestrong1">pdfWriter.addPage(pageObj)</span><br/><br/>
<span class="ent">&#x278F;</span> &gt;&gt;&gt; <span class="codestrong1">pdfOutputFile = open('combinedminutes.pdf', 'wb')</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdfWriter.write(pdfOutputFile)</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdfOutputFile.close()</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdf1File.close()</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdf2File.close()</span></p>
<p class="indent">Open both PDF files in read binary mode and store the two resulting <span class="literal">File</span> objects in <span class="literal">pdf1File</span> and <span class="literal">pdf2File</span>. Call <span class="literal">PyPDF2.PdfFileReader()</span> and pass it <span class="literal">pdf1File</span> to get a <span class="literal">PdfFileReader</span> object for <em>meetingminutes.pdf</em> <span class="ent">&#x278A;</span>. Call it again and pass it <span class="literal">pdf2File</span> to get a <span class="literal">PdfFileReader</span> object for <em>meetingminutes2.pdf</em> <span class="ent">&#x278B;</span>. Then create a new <span class="literal">PdfFileWriter</span> object, which represents a blank PDF document <span class="ent">&#x278C;</span>.</p>
<p class="indent"><span epub:type="pagebreak" id="page_352"/>Next, copy all the pages from the two source PDFs and add them to the <span class="literal">PdfFileWriter</span> object. Get the <span class="literal">Page</span> object by calling <span class="literal">getPage()</span> on a <span class="literal">PdfFileReader</span> object <span class="ent">&#x278D;</span>. Then pass that <span class="literal">Page</span> object to your PdfFileWriter&#8217;s <span class="literal">addPage()</span> method <span class="ent">&#x278E;</span>. These steps are done first for <span class="literal">pdf1Reader</span> and then again for <span class="literal">pdf2Reader</span>. When you&#8217;re done copying pages, write a new PDF called <em>combinedminutes.pdf</em> by passing a <span class="literal">File</span> object to the PdfFileWriter&#8217;s <span class="literal">write()</span> method <span class="ent">&#x278F;</span>.</p>
<div class="note">
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>
<p class="notep"><em>PyPDF2 cannot insert pages in the middle of a <span class="codeitalic">PdfFileWriter</span> object; the <span class="codeitalic">addPage()</span> method will only add pages to the end.</em></p>
</div>
<p class="indent">You have now created a new PDF file that combines the pages from <em>meetingminutes.pdf</em> and <em>meetingminutes2.pdf</em> into a single document. Remember that the <span class="literal">File</span> object passed to <span class="literal">PyPDF2.PdfFileReader()</span> needs to be opened in read-binary mode by passing <span class="literal">'rb'</span> as the second argument to <span class="literal">open()</span>. Likewise, the <span class="literal">File</span> object passed to <span class="literal">PyPDF2.PdfFileWriter()</span> needs to be opened in write-binary mode with <span class="literal">'wb'</span>.</p>
<h5 class="h5" id="ch15lev3sec2"><strong>Rotating Pages</strong></h5>
<p class="noindent">The pages of a PDF can also be rotated in 90-degree increments with the <span class="literal">rotateClockwise()</span> and <span class="literal">rotateCounterClockwise()</span> methods. Pass one of the integers <span class="literal">90</span>, <span class="literal">180</span>, or <span class="literal">270</span> to these methods. Enter the following into the interactive shell, with the <em>meetingminutes.pdf</em> file in the current working directory:</p>
<p class="programs">&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">import PyPDF2</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">minutesFile =</span> <span class="codestrong1">open('meetingminutes.pdf', 'rb')</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdfReader = PyPDF2.PdfFileReader(minutesFile)</span><br/>
<span class="ent">&#x278A;</span> &gt;&gt;&gt; <span class="codestrong1">page = pdfReader.getPage(0)</span><br/>
<span class="ent">&#x278B;</span> &gt;&gt;&gt; <span class="codestrong1">page.rotateClockwise(90)</span><br/>
&#160;&#160;&#160;{'/Contents': [IndirectObject(961, 0), IndirectObject(962, 0),<br/>
&#160;&#160;&#160;--<span class="codeitalic1">snip</span>--<br/>
&#160;&#160;&#160;}<br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdfWriter = PyPDF2.PdfFileWriter()</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdfWriter.addPage(page)</span><br/>
<span class="ent">&#x278C;</span> &gt;&gt;&gt; <span class="codestrong1">resultPdfFile = open('rotatedPage.pdf', 'wb')</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdfWriter.write(resultPdfFile)</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">resultPdfFile.close()</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">minutesFile.close()</span></p>
<p class="indent">Here we use <span class="literal">getPage(0)</span> to select the first page of the PDF <span class="ent">&#x278A;</span>, and then we call <span class="literal">rotateClockwise(90)</span> on that page <span class="ent">&#x278B;</span>. We write a new PDF with the rotated page and save it as <em>rotatedPage.pdf</em> <span class="ent">&#x278C;</span>.</p>
<p class="indent">The resulting PDF will have one page, rotated 90 degrees clockwise, as shown in <a href="ch15.xhtml#ch15fig02">Figure 15-2</a>. The return values from <span class="literal">rotateClockwise()</span> and <span class="literal">rotateCounterClockwise()</span> contain a lot of information that you can ignore.</p>
<div class="image"><span epub:type="pagebreak" id="page_353"/><a id="ch15fig02"/><img src="../images/15fig02.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 15-2: The</em> rotatedPage.pdf <em>file with the page rotated 90 degrees clockwise</em></p>
<h5 class="h5" id="ch15lev3sec3"><strong>Overlaying Pages</strong></h5>
<p class="noindent">PyPDF2 can also overlay the contents of one page over another, which is useful for adding a logo, timestamp, or watermark to a page. With Python, it&#8217;s easy to add watermarks to multiple files and only to pages your program specifies.</p>
<p class="indent">Download <em>watermark.pdf</em> from <em><a href="https://nostarch.com/automatestuff2/">https://nostarch.com/automatestuff2/</a></em> and place the PDF in the current working directory along with <em>meetingminutes.pdf</em>. Then enter the following into the interactive shell:</p>
<p class="programs">&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">import PyPDF2</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">minutesFile = open('meetingminutes.pdf', 'rb')</span><br/>
<span class="ent">&#x278A;</span> &gt;&gt;&gt; <span class="codestrong1">pdfReader = PyPDF2.PdfFileReader(minutesFile)</span><br/>
<span class="ent">&#x278B;</span> &gt;&gt;&gt; <span class="codestrong1">minutesFirstPage = pdfReader.getPage(0)</span><br/>
<span class="ent">&#x278C;</span> &gt;&gt;&gt; <span class="codestrong1">pdfWatermarkReader = PyPDF2.PdfFileReader(open('watermark.pdf', 'rb'))</span><br/>
<span class="ent">&#x278D;</span> &gt;&gt;&gt; <span class="codestrong1">minutesFirstPage.mergePage(pdfWatermarkReader.getPage(0))</span><br/>
<span class="ent">&#x278E;</span> &gt;&gt;&gt; <span class="codestrong1">pdfWriter = PyPDF2.PdfFileWriter()</span><br/>
<span class="ent">&#x278F;</span> &gt;&gt;&gt; <span class="codestrong1">pdfWriter.addPage(minutesFirstPage)</span><br/><br/>
<span class="ent">&#x2790;</span> &gt;&gt;&gt; <span class="codestrong1">for pageNum in range(1, pdfReader.numPages):</span><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="codestrong1">pageObj = pdfReader.getPage(pageNum)</span><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="codestrong1">pdfWriter.addPage(pageObj)</span><br/><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">resultPdfFile = open('watermarkedCover.pdf', 'wb')</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdfWriter.write(resultPdfFile)</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">minutesFile.close()</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">resultPdfFile.close()</span></p>
<p class="indent"><span epub:type="pagebreak" id="page_354"/>Here we make a <span class="literal">PdfFileReader</span> object of <em>meetingminutes.pdf</em> <span class="ent">&#x278A;</span>. We call <span class="literal">getPage(0)</span> to get a <span class="literal">Page</span> object for the first page and store this object in <span class="literal">minutesFirstPage</span> <span class="ent">&#x278B;</span>. We then make a <span class="literal">PdfFileReader</span> object for <em>watermark.pdf</em> <span class="ent">&#x278C;</span> and call <span class="literal">mergePage()</span> on <span class="literal">minutesFirstPage</span> <span class="ent">&#x278D;</span>. The argument we pass to <span class="literal">mergePage()</span> is a <span class="literal">Page</span> object for the first page of <em>watermark.pdf</em>.</p>
<p class="indent">Now that we&#8217;ve called <span class="literal">mergePage()</span> on <span class="literal">minutesFirstPage</span>, <span class="literal">minutesFirstPage</span> represents the watermarked first page. We make a <span class="literal">PdfFileWriter</span> object <span class="ent">&#x278E;</span> and add the watermarked first page <span class="ent">&#x278F;</span>. Then we loop through the rest of the pages in <em>meetingminutes.pdf</em> and add them to the <span class="literal">PdfFileWriter</span> object <span class="ent">&#x2790;</span>. Finally, we open a new PDF called <em>watermarkedCover.pdf</em> and write the contents of the PdfFileWriter to the new PDF.</p>
<p class="indent"><a href="ch15.xhtml#ch15fig03">Figure 15-3</a> shows the results. Our new PDF, <em>watermarkedCover.pdf</em>, has all the contents of the <em>meetingminutes.pdf</em>, and the first page is watermarked.</p>
<div class="image"><a id="ch15fig03"/><img src="../images/15fig03.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 15-3: The original PDF (left), the watermark PDF (center), and the merged PDF (right)</em></p>
<h5 class="h5" id="ch15lev3sec4"><strong>Encrypting PDFs</strong></h5>
<p class="noindent">A <span class="literal">PdfFileWriter</span> object can also add encryption to a PDF document. Enter the following into the interactive shell:</p>
<p class="programs">&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">import PyPDF2</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdfFile = open('meetingminutes.pdf', 'rb')</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdfReader = PyPDF2.PdfFileReader(pdfFile)</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdfWriter = PyPDF2.PdfFileWriter()</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">for pageNum in range(pdfReader.numPages):</span><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="codestrong1">pdfWriter.addPage(pdfReader.getPage(pageNum))</span><br/><br/>
<span class="ent">&#x278A;</span> &gt;&gt;&gt; <span class="codestrong1">pdfWriter.encrypt('swordfish')</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">resultPdf = open('encryptedminutes.pdf', 'wb')</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">pdfWriter.write(resultPdf)</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">resultPdf.close()</span></p>
<p class="indent">Before calling the <span class="literal">write()</span> method to save to a file, call the <span class="literal">encrypt()</span> method and pass it a password string <span class="ent">&#x278A;</span>. PDFs can have a <em>user password</em> (allowing you to view the PDF) and an <em>owner password</em> (allowing you to set permissions for printing, commenting, extracting text, and other features). The user password and owner password are the first and second arguments <span epub:type="pagebreak" id="page_355"/>to <span class="literal">encrypt()</span>, respectively. If only one string argument is passed to <span class="literal">encrypt()</span>, it will be used for both passwords.</p>
<p class="indent">In this example, we copied the pages of <em>meetingminutes.pdf</em> to a <span class="literal">PdfFileWriter</span> object. We encrypted the <span class="literal">PdfFileWriter</span> with the password <em>swordfish</em>, opened a new PDF called <em>encryptedminutes.pdf</em>, and wrote the contents of the <span class="literal">PdfFileWriter</span> to the new PDF. Before anyone can view <em>encryptedminutes.pdf</em>, they&#8217;ll have to enter this password. You may want to delete the original, unencrypted <em>meetingminutes.pdf</em> file after ensuring its copy was correctly encrypted.</p>
<h3 class="h3" id="ch15lev1sec2"><strong>Project: Combining Select Pages from Many PDFs</strong></h3>
<p class="noindent">Say you have the boring job of merging several dozen PDF documents into a single PDF file. Each of them has a cover sheet as the first page, but you don&#8217;t want the cover sheet repeated in the final result. Even though there are lots of free programs for combining PDFs, many of them simply merge entire files together. Let&#8217;s write a Python program to customize which pages you want in the combined PDF.</p>
<p class="indent">At a high level, here&#8217;s what the program will do:</p>
<ol>
<li class="noindent">Find all PDF files in the current working directory.</li>
<li class="noindent">Sort the filenames so the PDFs are added in order.</li>
<li class="noindent">Write each page, excluding the first page, of each PDF to the output file.</li>
</ol>
<p class="indent">In terms of implementation, your code will need to do the following:</p>
<ol>
<li class="noindent">Call <span class="literal">os.listdir()</span> to find all the files in the working directory and remove any non-PDF files.</li>
<li class="noindent">Call Python&#8217;s <span class="literal">sort()</span> list method to alphabetize the filenames.</li>
<li class="noindent">Create a <span class="literal">PdfFileWriter</span> object for the output PDF.</li>
<li class="noindent">Loop over each PDF file, creating a <span class="literal">PdfFileReader</span> object for it.</li>
<li class="noindent">Loop over each page (except the first) in each PDF file.</li>
<li class="noindent">Add the pages to the output PDF.</li>
<li class="noindent">Write the output PDF to a file named <em>allminutes.pdf</em>.</li>
</ol>
<p class="indent">For this project, open a new file editor tab and save it as <em>combinePdfs.py</em>.</p>
<h4 class="h4" id="ch15lev2sec4"><strong><em>Step 1: Find All PDF Files</em></strong></h4>
<p class="noindent">First, your program needs to get a list of all files with the <em>.pdf</em> extension in the current working directory and sort them. Make your code look like the following:</p>
<p class="programs">&#160;&#160;&#160;#! python3<br/>
&#160;&#160;&#160;# combinePdfs.py - Combines all the PDFs in the current working directory into<br/>
&#160;&#160;&#160;# into a single PDF.<br/><br/>
<span class="ent">&#x278A;</span> import PyPDF2, os<br/>
<span epub:type="pagebreak" id="page_356"/>&#160;&#160;&#160;# Get all the PDF filenames.<br/>
&#160;&#160;&#160;pdfFiles = []<br/>
&#160;&#160;&#160;for filename in os.listdir('.'):<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;if filename.endswith('.pdf'):<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="ent">&#x278B;</span> pdfFiles.append(filename)<br/>
<span class="ent">&#x278C;</span> pdfFiles.sort(key = str.lower)<br/><br/>
<span class="ent">&#x278D;</span> pdfWriter = PyPDF2.PdfFileWriter()<br/><br/>
&#160;&#160;&#160;# TODO: Loop through all the PDF files.<br/><br/>
&#160;&#160;&#160;# TODO: Loop through all the pages (except the first) and add them.<br/><br/>
&#160;&#160;&#160;# TODO: Save the resulting PDF to a file.</p>
<p class="indent">After the shebang line and the descriptive comment about what the program does, this code imports the <span class="literal">os</span> and <span class="literal">PyPDF2</span> modules <span class="ent">&#x278A;</span>. The <span class="literal">os.listdir('.')</span> call will return a list of every file in the current working directory. The code loops over this list and adds only those files with the <em>.pdf</em> extension to <span class="literal">pdfFiles</span> <span class="ent">&#x278B;</span>. Afterward, this list is sorted in alphabetical order with the <span class="literal">key = str.lower</span> keyword argument to <span class="literal">sort()</span> <span class="ent">&#x278C;</span>.</p>
<p class="indent">A <span class="literal">PdfFileWriter</span> object is created to hold the combined PDF pages <span class="ent">&#x278D;</span>. Finally, a few comments outline the rest of the program.</p>
<h4 class="h4" id="ch15lev2sec5"><strong><em>Step 2: Open Each PDF</em></strong></h4>
<p class="noindent">Now the program must read each PDF file in <span class="literal">pdfFiles</span>. Add the following to your program:</p>
<p class="programs">#! python3<br/>
# combinePdfs.py - Combines all the PDFs in the current working directory into <br/>
# a single PDF.<br/><br/>
import PyPDF2, os<br/><br/>
# Get all the PDF filenames.<br/>
pdfFiles = []<br/>
--<span class="codeitalic1">snip</span>--<br/><br/>
<span class="codestrong1"># Loop through all the PDF files.</span><br/>
<span class="codestrong1">for filename in pdfFiles:</span><br/>
&#160;&#160;&#160;&#160;<span class="codestrong1">pdfFileObj = open(filename, 'rb')</span><br/>
&#160;&#160;&#160;&#160;<span class="codestrong1">pdfReader = PyPDF2.PdfFileReader(pdfFileObj)</span><br/>
&#160;&#160;&#160;&#160;# TODO: Loop through all the pages (except the first) and add them.<br/><br/>
# TODO: Save the resulting PDF to a file.</p>
<p class="indent">For each PDF, the loop opens a filename in read-binary mode by calling <span class="literal">open()</span> with <span class="literal">'rb'</span> as the second argument. The <span class="literal">open()</span> call returns a <span class="literal">File</span> object, which gets passed to <span class="literal">PyPDF2.PdfFileReader()</span> to create a <span class="literal">PdfFileReader</span> object for that PDF file.</p>
<h4 class="h4" id="ch15lev2sec6"><span epub:type="pagebreak" id="page_357"/><strong><em>Step 3: Add Each Page</em></strong></h4>
<p class="noindent">For each PDF, you&#8217;ll want to loop over every page except the first. Add this code to your program:</p>
<p class="programs">#! python3<br/>
# combinePdfs.py - Combines all the PDFs in the current working directory into <br/>
# a single PDF.<br/><br/>
import PyPDF2, os<br/><br/>
--<span class="codeitalic1">snip</span>--<br/><br/>
# Loop through all the PDF files.<br/>
for filename in pdfFiles:<br/>
--<span class="codeitalic1">snip</span>--<br/>
&#160;&#160;&#160;&#160;&#160;<span class="codestrong1"># Loop through all the pages (except the first) and add them.</span><br/>
&#160;&#160;<span class="ent">&#x278A;</span> <span class="codestrong1">for pageNum in range(1, pdfReader.numPages):</span><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="codestrong1">pageObj = pdfReader.getPage(pageNum)</span><br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;<span class="codestrong1">pdfWriter.addPage(pageObj)</span><br/><br/>
# TODO: Save the resulting PDF to a file.</p>
<p class="indent">The code inside the <span class="literal">for</span> loop copies each <span class="literal">Page</span> object individually to the <span class="literal">PdfFileWriter</span> object. Remember, you want to skip the first page. Since PyPDF2 considers <span class="literal">0</span> to be the first page, your loop should start at <span class="literal">1</span> <span class="ent">&#x278A;</span> and then go up to, but not include, the integer in <span class="literal">pdfReader.numPages</span>.</p>
<h4 class="h4" id="ch15lev2sec7"><strong><em>Step 4: Save the Results</em></strong></h4>
<p class="noindent">After these nested <span class="literal">for</span> loops are done looping, the <span class="literal">pdfWriter</span> variable will contain a <span class="literal">PdfFileWriter</span> object with the pages for all the PDFs combined. The last step is to write this content to a file on the hard drive. Add this code to your program:</p>
<p class="programs">#! python3<br/>
# combinePdfs.py - Combines all the PDFs in the current working directory into <br/>
# a single PDF.<br/><br/>
import PyPDF2, os<br/><br/>
--<span class="codeitalic1">snip</span>--<br/><br/>
# Loop through all the PDF files.<br/>
for filename in pdfFiles:<br/>
--<span class="codeitalic1">snip</span>--<br/>
&#160;&#160;&#160;&#160;# Loop through all the pages (except the first) and add them.<br/>
&#160;&#160;&#160;&#160;for pageNum in range(1, pdfReader.numPages):<br/>
&#160;&#160;&#160;&#160;--<span class="codeitalic1">snip</span>--<br/><br/>
<span class="codestrong1"># Save the resulting PDF to a file.</span><br/>
<span class="codestrong1">pdfOutput = open('allminutes.pdf', 'wb')</span><br/>
<span epub:type="pagebreak" id="page_358"/><span class="codestrong1">pdfWriter.write(pdfOutput)</span><br/>
<span class="codestrong1">pdfOutput.close()</span></p>
<p class="indent">Passing <span class="literal">'wb'</span> to <span class="literal">open()</span> opens the output PDF file, <em>allminutes.pdf</em>, in write-binary mode. Then, passing the resulting <span class="literal">File</span> object to the <span class="literal">write()</span> method creates the actual PDF file. A call to the <span class="literal">close()</span> method finishes the program.</p>
<h4 class="h4" id="ch15lev2sec8"><strong><em>Ideas for Similar Programs</em></strong></h4>
<p class="noindent">Being able to create PDFs from the pages of other PDFs will let you make programs that can do the following:</p>
<ul>
<li class="noindent">Cut out specific pages from PDFs.</li>
<li class="noindent">Reorder pages in a PDF.</li>
<li class="noindent">Create a PDF from only those pages that have some specific text, identified by <span class="literal">extractText()</span>.</li>
</ul>
<h3 class="h3" id="ch15lev1sec3"><strong>Word Documents</strong></h3>
<p class="noindent">Python can create and modify Word documents, which have the <em>.docx</em> file extension, with the <span class="literal">docx</span> module. You can install the module by running <span class="literal">pip install --user -U python-docx==0.8.10</span>. (<a href="app01.xhtml#app01">Appendix A</a> has full details on installing third-party modules.)</p>
<div class="note">
<p class="notet"><strong><span class="notes">NOTE</span></strong></p>
<p class="notep"><em>When using pip to first install Python-Docx, be sure to install <span class="codeitalic">python-docx</span>, not <span class="codeitalic">docx</span>. The package name <span class="codeitalic">docx</span> is for a different module that this book does not cover. However, when you are going to import the module from the <span class="codeitalic">python-docx</span> package, you&#8217;ll need to run <span class="codeitalic">import docx</span>, not <span class="codeitalic">import python-docx</span>.</em></p>
</div>
<p class="indent">If you don&#8217;t have Word, LibreOffice Writer and OpenOffice Writer are free alternative applications for Windows, macOS, and Linux that can be used to open <em>.docx</em> files. You can download them from <em><a href="https://www.libreoffice.org/">https://www.libreoffice.org/</a></em> and <em><a href="https://openoffice.org/">https://openoffice.org/</a></em>, respectively. The full documentation for Python-Docx is available at <em><a href="https://python-docx.readthedocs.io/">https://python-docx.readthedocs.io/</a></em>. Although there is a version of Word for macOS, this chapter will focus on Word for Windows.</p>
<p class="indent">Compared to plaintext, <em>.docx</em> files have a lot of structure. This structure is represented by three different data types in Python-Docx. At the highest level, a <span class="literal">Document</span> object represents the entire document. The <span class="literal">Document</span> object contains a list of <span class="literal">Paragraph</span> objects for the paragraphs in the document. (A new paragraph begins whenever the user presses <small>ENTER</small> or <small>RETURN</small> while typing in a Word document.) Each of these <span class="literal">Paragraph</span> objects contains a list of one or more <span class="literal">Run</span> objects. The single-sentence paragraph in <a href="ch15.xhtml#ch15fig04">Figure 15-4</a> has four runs.</p>
<div class="image"><a id="ch15fig04"/><img src="../images/15fig04.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 15-4: The <span class="literal">Run</span> objects identified in a <span class="literal">Paragraph</span> object</em></p>
<p class="indent"><span epub:type="pagebreak" id="page_359"/>The text in a Word document is more than just a string. It has font, size, color, and other styling information associated with it. A <em>style</em> in Word is a collection of these attributes. A <span class="literal">Run</span> object is a contiguous run of text with the same style. A new <span class="literal">Run</span> object is needed whenever the text style changes.</p>
<h4 class="h4" id="ch15lev2sec9"><strong><em>Reading Word Documents</em></strong></h4>
<p class="noindent">Let&#8217;s experiment with the <span class="literal">docx</span> module. Download <em>demo.docx</em> from <em><a href="https://nostarch.com/automatestuff2/">https://nostarch.com/automatestuff2/</a></em> and save the document to the working directory. Then enter the following into the interactive shell:</p>
<p class="programs">&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">import docx</span><br/>
<span class="ent">&#x278A;</span> &gt;&gt;&gt; <span class="codestrong1">doc = docx.Document('demo.docx')</span><br/>
<span class="ent">&#x278B;</span> &gt;&gt;&gt; <span class="codestrong1">len(doc.paragraphs)</span><br/>
&#160;&#160;&#160;7<br/>
<span class="ent">&#x278C;</span> &gt;&gt;&gt; <span class="codestrong1">doc.paragraphs[0].text</span><br/>
&#160;&#160;&#160;'Document Title'<br/>
<span class="ent">&#x278D;</span> &gt;&gt;&gt; <span class="codestrong1">doc.paragraphs[1].text</span><br/>
&#160;&#160;&#160;'A plain paragraph with some bold and some italic'<br/>
<span class="ent">&#x278E;</span> &gt;&gt;&gt; <span class="codestrong1">len(doc.paragraphs[1].runs)</span><br/>
&#160;&#160;&#160;4<br/>
<span class="ent">&#x278F;</span> &gt;&gt;&gt; <span class="codestrong1">doc.paragraphs[1].runs[0].text</span><br/>
&#160;&#160;&#160;'A plain paragraph with some '<br/>
<span class="ent">&#x2790;</span> &gt;&gt;&gt; <span class="codestrong1">doc.paragraphs[1].runs[1].text</span><br/>
&#160;&#160;&#160;'bold'<br/>
<span class="ent">&#x2791;</span> &gt;&gt;&gt; <span class="codestrong1">doc.paragraphs[1].runs[2].text</span><br/>
&#160;&#160;&#160;' and some '<br/>
<span class="ent">&#x2792;</span> &gt;&gt;&gt; <span class="codestrong1">doc.paragraphs[1].runs[3].text</span><br/>
&#160;&#160;&#160;'italic'</p>
<p class="indent">At <span class="ent">&#x278A;</span>, we open a <em>.docx</em> file in Python, call <span class="literal">docx.Document()</span>, and pass the filename <em>demo.docx</em>. This will return a <span class="literal">Document</span> object, which has a <span class="literal">paragraphs</span> attribute that is a list of <span class="literal">Paragraph</span> objects. When we call <span class="literal">len()</span> on <span class="literal">doc.paragraphs</span>, it returns <span class="literal">7</span>, which tells us that there are seven <span class="literal">Paragraph</span> objects in this document <span class="ent">&#x278B;</span>. Each of these <span class="literal">Paragraph</span> objects has a <span class="literal">text</span> attribute that contains a string of the text in that paragraph (without the style information). Here, the first <span class="literal">text</span> attribute contains <span class="literal">'DocumentTitle'</span> <span class="ent">&#x278C;</span>, and the second contains <span class="literal">'A plain paragraph with some bold and some italic'</span> <span class="ent">&#x278D;</span>.</p>
<p class="indent">Each <span class="literal">Paragraph</span> object also has a <span class="literal">runs</span> attribute that is a list of <span class="literal">Run</span> objects. <span class="literal">Run</span> objects also have a <span class="literal">text</span> attribute, containing just the text in that particular run. Let&#8217;s look at the <span class="literal">text</span> attributes in the second <span class="literal">Paragraph</span> object, <span class="literal">'A plain paragraph with some bold and some italic'</span>. Calling <span class="literal">len()</span> on this <span class="literal">Paragraph</span> object tells us that there are four <span class="literal">Run</span> objects <span class="ent">&#x278E;</span>. The first run object contains <span class="literal">'A plain paragraph with some '</span> <span class="ent">&#x278F;</span>. Then, the text changes to a bold style, so <span class="literal">'bold'</span> starts a new <span class="literal">Run</span> object <span class="ent">&#x2790;</span>. The text returns to an unbolded style after that, which results in a third <span class="literal">Run</span> object, <span class="literal">' and some '</span> <span class="ent">&#x2791;</span>. Finally, the fourth and last <span class="literal">Run</span> object contains <span class="literal">'italic'</span> in an italic style <span class="ent">&#x2792;</span>.</p>
<p class="indent">With Python-Docx, your Python programs will now be able to read the text from a <em>.docx</em> file and use it just like any other string value.</p>
<h4 class="h4" id="ch15lev2sec10"><span epub:type="pagebreak" id="page_360"/><strong><em>Getting the Full Text from a .docx File</em></strong></h4>
<p class="noindent">If you care only about the text, not the styling information, in the Word document, you can use the <span class="literal">getText()</span> function. It accepts a filename of a <em>.docx</em> file and returns a single string value of its text. Open a new file editor tab and enter the following code, saving it as <em>readDocx.py</em>:</p>
<p class="programs">#! python3<br/><br/>
import docx<br/><br/>
def getText(filename):<br/>
&#160;&#160;&#160;&#160;doc = docx.Document(filename)<br/>
&#160;&#160;&#160;&#160;fullText = []<br/>
&#160;&#160;&#160;&#160;for para in doc.paragraphs:<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;fullText.append(para.text)<br/>
&#160;&#160;&#160;&#160;return '\n'.join(fullText)</p>
<p class="indent">The <span class="literal">getText()</span> function opens the Word document, loops over all the <span class="literal">Paragraph</span> objects in the <span class="literal">paragraphs</span> list, and then appends their text to the list in <span class="literal">fullText</span>. After the loop, the strings in <span class="literal">fullText</span> are joined together with newline characters.</p>
<p class="indent">The <em>readDocx.py</em> program can be imported like any other module. Now if you just need the text from a Word document, you can enter the following:</p>
<p class="programs">&gt;&gt;&gt; <span class="codestrong1">import readDocx</span><br/>
&gt;&gt;&gt; <span class="codestrong1">print(readDocx.getText('demo.docx'))</span><br/>
Document Title<br/>
A plain paragraph with some bold and some italic<br/>
Heading, level 1<br/>
Intense quote<br/>
first item in unordered list<br/>
first item in ordered list</p>
<p class="indent">You can also adjust <span class="literal">getText()</span> to modify the string before returning it. For example, to indent each paragraph, replace the <span class="literal">append()</span> call in <em>readDocx.py</em> with this:</p>
<p class="programs">fullText.append(<span class="codestrong1">'&#160;&#160;' +</span> para.text)</p>
<p class="indent">To add a double space between paragraphs, change the <span class="literal">join()</span> call code to this:</p>
<p class="programs">return '\n<span class="codestrong1">\n</span>'.join(fullText)</p>
<p class="indent">As you can see, it takes only a few lines of code to write functions that will read a <em>.docx</em> file and return a string of its content to your liking.</p>
<h4 class="h4" id="ch15lev2sec11"><span epub:type="pagebreak" id="page_361"/><strong><em>Styling Paragraph and Run Objects</em></strong></h4>
<p class="noindent">In Word for Windows, you can see the styles by pressing <small>CTRL</small>-<small>ALT</small>-<small>SHIFT</small>-S to display the Styles pane, which looks like <a href="ch15.xhtml#ch15fig05">Figure 15-5</a>. On macOS, you can view the Styles pane by clicking the <strong>View</strong> &#9656; <strong>Styles</strong> menu item.</p>
<div class="image"><a id="ch15fig05"/><img src="../images/15fig05.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 15-5: Display the Styles pane by pressing <small>CTRL-ALT-SHIFT</small>-S on Windows.</em></p>
<p class="indent">Word and other word processors use styles to keep the visual presentation of similar types of text consistent and easy to change. For example, perhaps you want to set body paragraphs in 11-point, Times New Roman, left-justified, ragged-right text. You can create a style with these settings and assign it to all body paragraphs. Then, if you later want to change the presentation of all body paragraphs in the document, you can just change the style, and all those paragraphs will be automatically updated.</p>
<p class="indent">For Word documents, there are three types of styles: <em>paragraph styles</em> can be applied to <span class="literal">Paragraph</span> objects, <em>character styles</em> can be applied to <span class="literal">Run</span> objects, and <em>linked styles</em> can be applied to both kinds of objects. You can give both <span class="literal">Paragraph</span> and <span class="literal">Run</span> objects styles by setting their <span class="literal">style</span> attribute to a string. This string should be the name of a style. If <span class="literal">style</span> is set to <span class="literal">None</span>, then there will be no style associated with the <span class="literal">Paragraph</span> or <span class="literal">Run</span> object.</p>
<p class="indent">The string values for the default Word styles are as follows:</p>
<table class="topbot-d">
<colgroup>
<col style="width:20%"/>
<col style="width:20%"/>
<col style="width:20%"/>
<col style="width:40%"/>
</colgroup>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">'Normal'</span></p>
<p class="noindent"><span class="literal">'Body Text'</span></p>
<p class="noindent"><span class="literal">'Body Text 2'</span></p>
<p class="noindent"><span class="literal">'Body Text 3'</span></p>
<p class="noindent"><span class="literal">'Caption'</span></p>
<p class="noindent"><span class="literal">'Heading 1'</span></p>
<p class="noindent"><span class="literal">'Heading 2'</span></p>
<p class="noindent"><span class="literal">'Heading 3'</span></p>
<p class="noindent"><span class="literal">'Heading 4'</span></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">'Heading 5'</span></p>
<p class="noindent"><span class="literal">'Heading 6'</span></p>
<p class="noindent"><span class="literal">'Heading 7'</span></p>
<p class="noindent"><span class="literal">'Heading 8'</span></p>
<p class="noindent"><span class="literal">'Heading 9'</span></p>
<p class="noindent"><span class="literal">'Intense Quote'</span></p>
<p class="noindent"><span class="literal">'List'</span></p>
<p class="noindent"><span class="literal">'List 2'</span></p>
<p class="noindent"><span class="literal">'List 3'</span></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">'List Bullet'</span></p>
<p class="noindent"><span class="literal">'List Bullet 2'</span></p>
<p class="noindent"><span class="literal">'List Bullet 3'</span></p>
<p class="noindent"><span class="literal">'List Continue'</span></p>
<p class="noindent"><span class="literal">'List Continue 2'</span></p>
<p class="noindent"><span class="literal">'List Continue 3'</span></p>
<p class="noindent"><span class="literal">'List Number '</span></p>
<p class="noindent"><span class="literal">'List Number 2'</span></p>
<p class="noindent"><span class="literal">'List Number 3'</span></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">'List Paragraph'</span></p>
<p class="noindent"><span class="literal">'MacroText'</span></p>
<p class="noindent"><span class="literal">'No Spacing'</span></p>
<p class="noindent"><span class="literal">'Quote'</span></p>
<p class="noindent"><span class="literal">'Subtitle'</span></p>
<p class="noindent"><span class="literal">'TOC Heading'</span></p>
<p class="noindent"><span class="literal">'Title'</span></p></td>
</tr>
</tbody>
</table>
<p class="indent"><span epub:type="pagebreak" id="page_362"/>When using a linked style for a <span class="literal">Run</span> object, you will need to add <span class="literal">' Char'</span> to the end of its name. For example, to set the Quote linked style for a <span class="literal">Paragraph</span> object, you would use <span class="literal">paragraphObj.style = 'Quote'</span>, but for a <span class="literal">Run</span> object, you would use <span class="literal">runObj.style = 'Quote Char'</span>.</p>
<p class="indent">In the current version of Python-Docx (0.8.10), the only styles that can be used are the default Word styles and the styles in the opened <em>.docx</em>. New styles cannot be created&#8212;though this may change in future versions of Python-Docx.</p>
<h4 class="h4" id="ch15lev2sec12"><strong><em>Creating Word Documents with Nondefault Styles</em></strong></h4>
<p class="noindent">If you want to create Word documents that use styles beyond the default ones, you will need to open Word to a blank Word document and create the styles yourself by clicking the <strong>New Style</strong> button at the bottom of the Styles pane (<a href="ch15.xhtml#ch15fig06">Figure 15-6</a> shows this on Windows).</p>
<p class="indent">This will open the Create New Style from Formatting dialog, where you can enter the new style. Then, go back into the interactive shell and open this blank Word document with <span class="literal">docx.Document()</span>, using it as the base for your Word document. The name you gave this style will now be available to use with Python-Docx.</p>
<div class="image"><a id="ch15fig06"/><img src="../images/15fig06.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 15-6: The New Style button (left) and the Create New Style from Formatting dialog (right)</em></p>
<h4 class="h4" id="ch15lev2sec13"><strong><em>Run Attributes</em></strong></h4>
<p class="noindent">Runs can be further styled using <span class="literal">text</span> attributes. Each attribute can be set to one of three values: <span class="literal">True</span> (the attribute is always enabled, no matter what other styles are applied to the run), <span class="literal">False</span> (the attribute is always disabled), or <span class="literal">None</span> (defaults to whatever the run&#8217;s style is set to).</p>
<p class="indent"><a href="ch15.xhtml#ch15tab01">Table 15-1</a> lists the <span class="literal">text</span> attributes that can be set on <span class="literal">Run</span> objects.</p>
<p class="tabcap" id="ch15tab01"><span epub:type="pagebreak" id="page_363"/><strong>Table 15-1:</strong> <span class="literal">Run</span> Object <span class="literal">text</span> Attributes</p>
<table class="topbot-d">
<colgroup>
<col style="width:50%"/>
<col style="width:50%"/>
</colgroup>
<thead>
<tr>
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Attribute</strong></p></td>
<td style="vertical-align: top;" class="table-h"><p class="tab_th"><strong>Description</strong></p></td>
</tr>
</thead>
<tbody>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">bold</span></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">The text appears in bold.</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-v"><p class="taba"><span class="literal">italic</span></p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">The text appears in italic.</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">underline</span></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">The text is underlined.</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-v"><p class="taba"><span class="literal">strike</span></p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">The text appears with strikethrough.</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">double_strike</span></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">The text appears with double strikethrough.</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-v"><p class="taba"><span class="literal">all_caps</span></p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">The text appears in capital letters.</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">small_caps</span></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">The text appears in capital letters, with lowercase letters two points smaller.</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-v"><p class="taba"><span class="literal">shadow</span></p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">The text appears with a shadow.</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">outline</span></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">The text appears outlined rather than solid.</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-v"><p class="taba"><span class="literal">rtl</span></p></td>
<td style="vertical-align: top;" class="table-v"><p class="taba">The text is written right-to-left.</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-b"><p class="taba"><span class="literal">imprint</span></p></td>
<td style="vertical-align: top;" class="table-b"><p class="taba">The text appears pressed into the page.</p></td>
</tr>
<tr>
<td style="vertical-align: top;" class="table-va"><p class="taba"><span class="literal">emboss</span></p></td>
<td style="vertical-align: top;" class="table-va"><p class="taba">The text appears raised off the page in relief.</p></td>
</tr>
</tbody>
</table>
<p class="indent">For example, to change the styles of <em>demo.docx</em>, enter the following into the interactive shell:</p>
<p class="programs">&gt;&gt;&gt; <span class="codestrong1">import docx</span><br/>
&gt;&gt;&gt; <span class="codestrong1">doc = docx.Document('demo.docx')</span><br/>
&gt;&gt;&gt; <span class="codestrong1">doc.paragraphs[0].text</span><br/>
'Document Title'<br/>
&gt;&gt;&gt; <span class="codestrong1">doc.paragraphs[0].style # The exact id may be different:</span><br/>
_ParagraphStyle('Title') id: 3095631007984<br/>
&gt;&gt;&gt; <span class="codestrong1">doc.paragraphs[0].style = 'Normal'</span><br/>
&gt;&gt;&gt; <span class="codestrong1">doc.paragraphs[1].text</span><br/>
'A plain paragraph with some bold and some italic'<br/>
&gt;&gt;&gt; <span class="codestrong1">(doc.paragraphs[1].runs[0].text, doc.paragraphs[1].runs[1].text, doc.<br/>
paragraphs[1].runs[2].text, doc.paragraphs[1].runs[3].text)</span><br/>
('A plain paragraph with some ', 'bold', ' and some ', 'italic')<br/>
&gt;&gt;&gt; <span class="codestrong1">doc.paragraphs[1].runs[0].style = 'QuoteChar'</span><br/>
&gt;&gt;&gt; <span class="codestrong1">doc.paragraphs[1].runs[1].underline = True</span><br/>
&gt;&gt;&gt; <span class="codestrong1">doc.paragraphs[1].runs[3].underline = True</span><br/>
&gt;&gt;&gt; <span class="codestrong1">doc.save('restyled.docx')</span></p>
<p class="indent">Here, we use the <span class="literal">text</span> and <span class="literal">style</span> attributes to easily see what&#8217;s in the paragraphs in our document. We can see that it&#8217;s simple to divide a paragraph into runs and access each run individually. So we get the first, second, and fourth runs in the second paragraph; style each run; and save the results to a new document.</p>
<p class="indent">The words <em>Document Title</em> at the top of <em>restyled.docx</em> will have the Normal style instead of the Title style, the <span class="literal">Run</span> object for the text <em>A plain paragraph with some</em> will have the QuoteChar style, and the two <span class="literal">Run</span> objects for the words <em>bold</em> <span epub:type="pagebreak" id="page_364"/>and <em>italic</em> will have their <span class="literal">underline</span> attributes set to <span class="literal">True</span>. <a href="ch15.xhtml#ch15fig07">Figure 15-7</a> shows how the styles of paragraphs and runs look in <em>restyled.docx</em>.</p>
<div class="image"><a id="ch15fig07"/><img src="../images/15fig07.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 15-7: The</em> restyled.docx <em>file</em></p>
<p class="indent">You can find more complete documentation on Python-Docx&#8217;s use of styles at <em><a href="https://python-docx.readthedocs.io/">https://python-docx.readthedocs.io/</a></em>.</p>
<h4 class="h4" id="ch15lev2sec14"><strong><em>Writing Word Documents</em></strong></h4>
<p class="noindent">Enter the following into the interactive shell:</p>
<p class="programs">&gt;&gt;&gt; <span class="codestrong1">import docx</span><br/>
&gt;&gt;&gt; <span class="codestrong1">doc = docx.Document()</span><br/>
&gt;&gt;&gt; <span class="codestrong1">doc.add_paragraph('Hello, world!')</span><br/>
&lt;docx.text.Paragraph object at 0x0000000003B56F60&gt;<br/>
&gt;&gt;&gt; <span class="codestrong1">doc.save('helloworld.docx')</span></p>
<p class="indent">To create your own <em>.docx</em> file, call <span class="literal">docx.Document()</span> to return a new, blank Word <span class="literal">Document</span> object. The <span class="literal">add_paragraph()</span> document method adds a new paragraph of text to the document and returns a reference to the <span class="literal">Paragraph</span> object that was added. When you&#8217;re done adding text, pass a filename string to the <span class="literal">save()</span> document method to save the <span class="literal">Document</span> object to a file.</p>
<p class="indent">This will create a file named <em>helloworld.docx</em> in the current working directory that, when opened, looks like <a href="ch15.xhtml#ch15fig08">Figure 15-8</a>.</p>
<div class="image"><a id="ch15fig08"/><img src="../images/15fig08.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 15-8: The Word document created using <span class="literal">add_paragraph('Hello, world!')</span></em></p>
<p class="indent"><span epub:type="pagebreak" id="page_365"/>You can add paragraphs by calling the <span class="literal">add_paragraph()</span> method again with the new paragraph&#8217;s text. Or to add text to the end of an existing paragraph, you can call the paragraph&#8217;s <span class="literal">add_run()</span> method and pass it a string. Enter the following into the interactive shell:</p>
<p class="programs">&gt;&gt;&gt; <span class="codestrong1">import docx</span><br/>
&gt;&gt;&gt; <span class="codestrong1">doc = docx.Document()</span><br/>
&gt;&gt;&gt; <span class="codestrong1">doc.add_paragraph('Hello world!')</span><br/>
&lt;docx.text.Paragraph object at 0x000000000366AD30&gt;<br/>
&gt;&gt;&gt; <span class="codestrong1">paraObj1 = doc.add_paragraph('This is a second paragraph.')</span><br/>
&gt;&gt;&gt; <span class="codestrong1">paraObj2 = doc.add_paragraph('This is a yet another paragraph.')</span><br/>
&gt;&gt;&gt; <span class="codestrong1">paraObj1.add_run(' This text is being added to the second paragraph.')</span><br/>
&lt;docx.text.Run object at 0x0000000003A2C860&gt;<br/>
&gt;&gt;&gt; <span class="codestrong1">doc.save('multipleParagraphs.docx')</span></p>
<p class="indent">The resulting document will look like <a href="ch15.xhtml#ch15fig09">Figure 15-9</a>. Note that the text <em>This text is being added to the second paragraph.</em> was added to the <span class="literal">Paragraph</span> object in <span class="literal">paraObj1</span>, which was the second paragraph added to <span class="literal">doc</span>. The <span class="literal">add_paragraph()</span> and <span class="literal">add_run()</span> functions return paragraph and <span class="literal">Run</span> objects, respectively, to save you the trouble of extracting them as a separate step.</p>
<p class="indent">Keep in mind that as of Python-Docx version 0.8.10, new <span class="literal">Paragraph</span> objects can be added only to the end of the document, and new <span class="literal">Run</span> objects can be added only to the end of a <span class="literal">Paragraph</span> object.</p>
<p class="indent">The <span class="literal">save()</span> method can be <span class="literal">called</span> again to save the additional changes you&#8217;ve made.</p>
<div class="image"><a id="ch15fig09"/><img src="../images/15fig09.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 15-9: The document with multiple <span class="literal">Paragraph</span> and <span class="literal">Run</span> objects added</em></p>
<p class="indent">Both <span class="literal">add_paragraph()</span> and <span class="literal">add_run()</span> accept an optional second argument that is a string of the <span class="literal">Paragraph</span> or <span class="literal">Run</span> object&#8217;s style. Here&#8217;s an example:</p>
<p class="programs">&gt;&gt;&gt; <span class="codestrong1">doc.add_paragraph('Hello, world!', 'Title')</span></p>
<p class="indent">This line adds a paragraph with the text <em>Hello, world!</em> in the Title style.</p>
<h4 class="h4" id="ch15lev2sec15"><span epub:type="pagebreak" id="page_366"/><strong><em>Adding Headings</em></strong></h4>
<p class="noindent">Calling <span class="literal">add_heading()</span> adds a paragraph with one of the heading styles. Enter the following into the interactive shell:</p>
<p class="programs">&gt;&gt;&gt; <span class="codestrong1">doc = docx.Document()</span><br/>
&gt;&gt;&gt; <span class="codestrong1">doc.add_heading('Header 0', 0)</span><br/>
&lt;docx.text.Paragraph object at 0x00000000036CB3C8&gt;<br/>
&gt;&gt;&gt; <span class="codestrong1">doc.add_heading('Header 1', 1)</span><br/>
&lt;docx.text.Paragraph object at 0x00000000036CB630&gt;<br/>
&gt;&gt;&gt; <span class="codestrong1">doc.add_heading('Header 2', 2)</span><br/>
&lt;docx.text.Paragraph object at 0x00000000036CB828&gt;<br/>
&gt;&gt;&gt; <span class="codestrong1">doc.add_heading('Header 3', 3)</span><br/>
&lt;docx.text.Paragraph object at 0x00000000036CB2E8&gt;<br/>
&gt;&gt;&gt; <span class="codestrong1">doc.add_heading('Header 4', 4)</span><br/>
&lt;docx.text.Paragraph object at 0x00000000036CB3C8&gt;<br/>
&gt;&gt;&gt; <span class="codestrong1">doc.save('headings.docx')</span></p>
<p class="indent">The arguments to <span class="literal">add_heading()</span> are a string of the heading text and an integer from <span class="literal">0</span> to <span class="literal">4</span>. The integer <span class="literal">0</span> makes the heading the Title style, which is used for the top of the document. Integers <span class="literal">1</span> to <span class="literal">4</span> are for various heading levels, with <span class="literal">1</span> being the main heading and <span class="literal">4</span> the lowest subheading. The <span class="literal">add_heading()</span> function returns a <span class="literal">Paragraph</span> object to save you the step of extracting it from the <span class="literal">Document</span> object as a separate step.</p>
<p class="indent">The resulting <em>headings.docx</em> file will look like <a href="ch15.xhtml#ch15fig10">Figure 15-10</a>.</p>
<div class="image"><a id="ch15fig10"/><img src="../images/15fig10.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 15-10: The</em> headings.docx <em>document with headings 0 to 4</em></p>
<h4 class="h4" id="ch15lev2sec16"><strong><em>Adding Line and Page Breaks</em></strong></h4>
<p class="noindent">To add a line break (rather than starting a whole new paragraph), you can call the <span class="literal">add_break()</span> method on the <span class="literal">Run</span> object you want to have the break appear after. If you want to add a page break instead, you need to pass the value <span class="literal">docx.enum.text.WD_BREAK.PAGE</span> as a lone argument to <span class="literal">add_break()</span>, as is done in the middle of the following example:</p>
<p class="programs">&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">doc = docx.Document()</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">doc.add_paragraph('This is on the first page!')</span><br/>
&#160;&#160;&#160;&lt;docx.text.Paragraph object at 0x0000000003785518&gt;<br/>
<span class="ent">&#x278A;</span> &gt;&gt;&gt; <span class="codestrong1">doc.paragraphs[0].runs[0].add_break(docx.enum.text.WD_BREAK.PAGE)</span><br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">doc.add_paragraph('This is on the second page!')</span><br/>
&#160;&#160;&#160;&lt;docx.text.Paragraph object at 0x00000000037855F8&gt;<br/>
&#160;&#160;&#160;&gt;&gt;&gt; <span class="codestrong1">doc.save('twoPage.docx')</span></p>
<p class="indent"><span epub:type="pagebreak" id="page_367"/>This creates a two-page Word document with <em>This is on the first page!</em> on the first page and <em>This is on the second page!</em> on the second. Even though there was still plenty of space on the first page after the text <em>This is on the first page!</em>, we forced the next paragraph to begin on a new page by inserting a page break after the first run of the first paragraph <span class="ent">&#x278A;</span>.</p>
<h4 class="h4" id="ch15lev2sec17"><strong><em>Adding Pictures</em></strong></h4>
<p class="noindent"><span class="literal">Document</span> objects have an <span class="literal">add_picture()</span> method that will let you add an image to the end of the document. Say you have a file <em>zophie.png</em> in the current working directory. You can add <em>zophie.png</em> to the end of your document with a width of 1 inch and height of 4 centimeters (Word can use both imperial and metric units) by entering the following:</p>
<p class="programs">&gt;&gt;&gt; <span class="codestrong1">doc.add_picture('zophie.png', width=docx.shared.Inches(1),</span><br/>
<span class="codestrong1">height=docx.shared.Cm(4))</span><br/>
&lt;docx.shape.InlineShape object at 0x00000000036C7D30&gt;</p>
<p class="indent">The first argument is a string of the image&#8217;s filename. The optional <span class="literal">width</span> and <span class="literal">height</span> keyword arguments will set the width and height of the image in the document. If left out, the width and height will default to the normal size of the image.</p>
<p class="indent">You&#8217;ll probably prefer to specify an image&#8217;s height and width in familiar units such as inches and centimeters, so you can use the <span class="literal">docx.shared.Inches()</span> and <span class="literal">docx.shared.Cm()</span> functions when you&#8217;re specifying the <span class="literal">width</span> and <span class="literal">height</span> keyword arguments.</p>
<h3 class="h3" id="ch15lev1sec4"><strong>Creating PDFs from Word Documents</strong></h3>
<p class="noindent">The PyPDF2 module doesn&#8217;t allow you to create PDF documents directly, but there&#8217;s a way to generate PDF files with Python if you&#8217;re on Windows and have Microsoft Word installed. You&#8217;ll need to install the Pywin32 package by running <span class="literal">pip install --user -U pywin32==224</span>. With this and the <span class="literal">docx</span> module, you can create Word documents and then convert them to PDFs with the following script.</p>
<p class="indent">Open a new file editor tab, enter the following code, and save it as <em>convertWordToPDF.py</em>:</p>
<p class="programs"># This script runs on Windows only, and you must have Word installed.<br/>
import win32com.client # install with "pip install pywin32==224"<br/>
import docx<br/>
wordFilename = '<span class="codeitalic1">your_word_document</span>.docx'<br/>
pdfFilename = '<span class="codeitalic1">your_pdf_filename</span>.pdf'<br/><br/>
doc = docx.Document()<br/>
# Code to create Word document goes here.<br/>
doc.save(wordFilename)<br/><br/>
wdFormatPDF = 17 # Word's numeric code for PDFs.<br/>
wordObj = win32com.client.Dispatch('Word.Application')<br/><br/>
<span epub:type="pagebreak" id="page_368"/>docObj = wordObj.Documents.Open(wordFilename)<br/>
docObj.SaveAs(pdfFilename, FileFormat=wdFormatPDF)<br/>
docObj.Close()<br/>
wordObj.Quit()</p>
<p class="indent">To write a program that produces PDFs with your own content, you must use the <span class="literal">docx</span> module to create a Word document, then use the Pywin32 package&#8217;s <span class="literal">win32com.client</span> module to convert it to a PDF. Replace the <span class="literal"># Code to create Word document goes here.</span> comment with <span class="literal">docx</span> function calls to create your own content for the PDF in a Word document.</p>
<p class="indent">This may seem like a convoluted way to produce PDFs, but as it turns out, professional software solutions are often just as complicated.</p>
<h3 class="h3" id="ch15lev1sec5"><strong>Summary</strong></h3>
<p class="noindent">Text information isn&#8217;t just for plaintext files; in fact, it&#8217;s pretty likely that you deal with PDFs and Word documents much more often. You can use the <span class="literal">PyPDF2</span> module to read and write PDF documents. Unfortunately, reading text from PDF documents might not always result in a perfect translation to a string because of the complicated PDF file format, and some PDFs might not be readable at all. In these cases, you&#8217;re out of luck unless future updates to PyPDF2 support additional PDF features.</p>
<p class="indent">Word documents are more reliable, and you can read them with the <span class="literal">python-docx</span> package&#8217;s <span class="literal">docx</span> module. You can manipulate text in Word documents via <span class="literal">Paragraph</span> and <span class="literal">Run</span> objects. These objects can also be given styles, though they must be from the default set of styles or styles already in the document. You can add new paragraphs, headings, breaks, and pictures to the document, though only to the end.</p>
<p class="indent">Many of the limitations that come with working with PDFs and Word documents are because these formats are meant to be nicely displayed for human readers, rather than easy to parse by software. The next chapter takes a look at two other common formats for storing information: JSON and CSV files. These formats are designed to be used by computers, and you&#8217;ll see that Python can work with these formats much more easily.</p>
<h3 class="h3" id="ch15lev1sec6"><strong>Practice Questions</strong></h3>
<p class="question"><a id="ch15que1" href="app03.xhtml#ch15ans1">1</a>. A string value of the PDF filename is <em>not</em> passed to the <span class="literal">PyPDF2.PdfFileReader()</span> function. What do you pass to the function instead?</p>
<p class="question"><a id="ch15que2" href="app03.xhtml#ch15ans2">2</a>. What modes do the <span class="literal">File</span> objects for <span class="literal">PdfFileReader()</span> and <span class="literal">PdfFileWriter()</span> need to be opened in?</p>
<p class="question"><a id="ch15que3" href="app03.xhtml#ch15ans3">3</a>. How do you acquire a <span class="literal">Page</span> object for <a href="ch01.xhtml#page_5">page 5</a> from a <span class="literal">PdfFileReader</span> object?</p>
<p class="question"><a id="ch15que4" href="app03.xhtml#ch15ans4">4</a>. What <span class="literal">PdfFileReader</span> variable stores the number of pages in the PDF document?</p>
<p class="question"><a id="ch15que5" href="app03.xhtml#ch15ans5">5</a>. If a <span class="literal">PdfFileReader</span> object&#8217;s PDF is encrypted with the password <span class="literal">swordfish</span>, what must you do before you can obtain <span class="literal">Page</span> objects from it?</p>
<p class="question"><a id="ch15que6" href="app03.xhtml#ch15ans6">6</a>. <span epub:type="pagebreak" id="page_369"/>What methods do you use to rotate a page?</p>
<p class="question"><a id="ch15que7" href="app03.xhtml#ch15ans7">7</a>. What method returns a <span class="literal">Document</span> object for a file named <em>demo.docx</em>?</p>
<p class="question"><a id="ch15que8" href="app03.xhtml#ch15ans8">8</a>. What is the difference between a <span class="literal">Paragraph</span> object and a <span class="literal">Run</span> object?</p>
<p class="question"><a id="ch15que9" href="app03.xhtml#ch15ans9">9</a>. How do you obtain a list of <span class="literal">Paragraph</span> objects for a <span class="literal">Document</span> object that&#8217;s stored in a variable named <span class="literal">doc</span>?</p>
<p class="question1"><a id="ch15que10" href="app03.xhtml#ch15ans10">10</a>. What type of object has <span class="literal">bold</span>, <span class="literal">underline</span>, <span class="literal">italic</span>, <span class="literal">strike</span>, and <span class="literal">outline</span> variables?</p>
<p class="question1"><a id="ch15que11" href="app03.xhtml#ch15ans11">11</a>. What is the difference between setting the <span class="literal">bold</span> variable to <span class="literal">True</span>, <span class="literal">False</span>, or <span class="literal">None</span>?</p>
<p class="question1"><a id="ch15que12" href="app03.xhtml#ch15ans12">12</a>. How do you create a <span class="literal">Document</span> object for a new Word document?</p>
<p class="question1"><a id="ch15que13" href="app03.xhtml#ch15ans13">13</a>. How do you add a paragraph with the text <span class="literal">'Hello, there!'</span> to a <span class="literal">Document</span> object stored in a variable named <span class="literal">doc</span>?</p>
<p class="question1"><a id="ch15que14" href="app03.xhtml#ch15ans14">14</a>. What integers represent the levels of headings available in Word documents?</p>
<h3 class="h3" id="ch15lev1sec7"><strong>Practice Projects</strong></h3>
<p class="noindent">For practice, write programs that do the following.</p>
<h4 class="h4" id="ch15lev2sec18"><strong><em>PDF Paranoia</em></strong></h4>
<p class="noindent">Using the <span class="literal">os.walk()</span> function from <a href="ch10.xhtml#ch10">Chapter 10</a>, write a script that will go through every PDF in a folder (and its subfolders) and encrypt the PDFs using a password provided on the command line. Save each encrypted PDF with an <em>_encrypted.pdf</em> suffix added to the original filename. Before deleting the original file, have the program attempt to read and decrypt the file to ensure that it was encrypted correctly.</p>
<p class="indent">Then, write a program that finds all encrypted PDFs in a folder (and its subfolders) and creates a decrypted copy of the PDF using a provided password. If the password is incorrect, the program should print a message to the user and continue to the next PDF.</p>
<h4 class="h4" id="ch15lev2sec19"><strong><em>Custom Invitations as Word Documents</em></strong></h4>
<p class="noindent">Say you have a text file of guest names. This <em>guests.txt</em> file has one name per line, as follows:</p>
<p class="programs">Prof. Plum<br/>
Miss Scarlet<br/>
Col. Mustard<br/>
Al Sweigart<br/>
RoboCop</p>
<p class="indent">Write a program that would generate a Word document with custom invitations that look like <a href="ch15.xhtml#ch15fig11">Figure 15-11</a>.</p>
<p class="indent">Since Python-Docx can use only those styles that already exist in the Word document, you will have to first add these styles to a blank Word file and then open that file with Python-Docx. There should be one invitation <span epub:type="pagebreak" id="page_370"/>per page in the resulting Word document, so call <span class="literal">add_break()</span> to add a page break after the last paragraph of each invitation. This way, you will need to open only one Word document to print all of the invitations at once.</p>
<div class="image"><a id="ch15fig11"/><img src="../images/15fig11.jpg" alt="image"/></div>
<p class="figcap"><em>Figure 15-11: The Word document generated by your custom invite script</em></p>
<p class="indent">You can download a sample <em>guests.txt</em> file from <em><a href="https://nostarch.com/automatestuff2/">https://nostarch.com/automatestuff2/</a></em>.</p>
<h4 class="h4" id="ch15lev2sec20"><strong><em>Brute-Force PDF Password Breaker</em></strong></h4>
<p class="noindent">Say you have an encrypted PDF that you have forgotten the password to, but you remember it was a single English word. Trying to guess your forgotten password is quite a boring task. Instead you can write a program that will decrypt the PDF by trying every possible English word until it finds one that works. This is called a <em>brute-force password attack.</em> Download the text file <em>dictionary.txt</em> from <em><a href="https://nostarch.com/automatestuff2/">https://nostarch.com/automatestuff2/</a></em>. This <em>dictionary file</em> contains over 44,000 English words with one word per line.</p>
<p class="indent">Using the file-reading skills you learned in <a href="ch09.xhtml#ch09">Chapter 9</a>, create a list of word strings by reading this file. Then loop over each word in this list, passing it to the <span class="literal">decrypt()</span> method. If this method returns the integer <span class="literal">0</span>, the password was wrong and your program should continue to the next password. If <span class="literal">decrypt()</span> returns <span class="literal">1</span>, then your program should break out of the loop and print the hacked password. You should try both the uppercase and lowercase form of each word. (On my laptop, going through all 88,000 uppercase and lowercase words from the dictionary file takes a couple of minutes. This is why you shouldn&#8217;t use a simple English word for your passwords.)</p>
</body>
</html>
